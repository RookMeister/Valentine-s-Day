{"version":3,"sources":["src/background.js"],"names":["Vector3","Matrix44","create","x","y","z","dot","v0","v1","cross","v","normalize","l","Math","sqrt","arrayForm","array","Float32Array","createIdentity","loadProjection","m","aspect","vdeg","near","far","h","tan","PI","w","loadLookAt","vpos","vlook","vup","frontv","sidev","topv","gl","timeInfo","renderSpec","deleteRenderTarget","rt","deleteFramebuffer","frameBuffer","deleteRenderbuffer","renderBuffer","deleteTexture","texture","createRenderTarget","ret","createFramebuffer","createRenderbuffer","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","compileShader","shtype","shsrc","retsh","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","errlog","getShaderInfoLog","deleteShader","console","error","vtxsrc","frgsrc","uniformlist","attrlist","vsh","VERTEX_SHADER","fsh","FRAGMENT_SHADER","prog","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniforms","i","length","getUniformLocation","attributes","attr","getAttribLocation","useShader","useProgram","enableVertexAttribArray","unuseShader","disableVertexAttribArray","setSize","width","height","halfWidth","floor","halfHeight","halfArray","projection","camera","pointFlower","meshFlower","sceneStandBy","BlossomParticle","velocity","Array","rotation","position","euler","size","alpha","zkey","createPointFlowers","prm","getParameter","ALIASED_POINT_SIZE_RANGE","pointSize","document","getElementById","textContent","program","offset","fader","numFlowers","particles","dataArray","positionArrayOffset","eulerArrayOffset","miscArrayOffset","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","initPointFlowers","area","PI2","tmpv3","tmpv","symmetryrand","random","tmpprtcl","setVelocity","setRotation","setPosition","setEulerAngles","renderPointFlowers","repeatPos","prt","cmp","limit","abs","repeatEuler","prtcl","update","delta","elapsed","matrix","sort","p0","p1","ipos","ieuler","imisc","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","uniformMatrix4fv","uProjection","uModelview","uniform3fv","uResolution","uDOF","dof","uFade","vertexAttribPointer","aPosition","FLOAT","BYTES_PER_ELEMENT","aEuler","aMisc","zpos","uOffset","drawArrays","POINT","DEPTH_TEST","disable","createEffectProgram","exunifs","exattrs","unifs","concat","attrs","STATIC_DRAW","useEffect","fxobj","srctex","uniform2fv","uDelta","dtxArray","uniform1i","uSrc","activeTexture","TEXTURE0","drawEffect","TRIANGLE_STRIP","unuseEffect","prototype","vx","vy","vz","rx","ry","rz","nx","ny","nz","s","dt","et","effectLib","createEffectLib","cmnvtxsrc","sceneBg","mkBrightBuf","dirBlur","finalComp","createBackground","initBackground","renderBackground","uniform2f","uTimes","postProcess","createPostProcess","initPostProcess","renderPostProcess","bindRT","isclear","viewport","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","wHalfRT0","mainRT","p","wHalfRT1","uniform4f","uBlurDir","uBloom","TEXTURE1","SceneEnv","createScene","initScene","nearfar","angle","atan2","renderScene","lookat","up","onResize","e","makeCanvasFullScreen","setViewports","canvas","rtfunc","rtname","rtw","rth","render","animating","toggleAnimation","elm","animate","innerHTML","stepAnimation","curdate","Date","start","prev","requestAnimationFrame","b","body","d","documentElement","fullw","max","clientWidth","scrollWidth","fullh","clientHeight","scrollHeight","window","addEventListener","getContext","alert","r","c","setTimeout"],"mappings":"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","file":"background.4f0c15d8.map","sourceRoot":"..","sourcesContent":["// Utilities\nvar Vector3 = {};\nvar Matrix44 = {};\nVector3.create = function(x, y, z) {\n    return {'x':x, 'y':y, 'z':z};\n};\nVector3.dot = function (v0, v1) {\n    return v0.x * v1.x + v0.y * v1.y + v0.z * v1.z;\n};\nVector3.cross = function (v, v0, v1) {\n    v.x = v0.y * v1.z - v0.z * v1.y;\n    v.y = v0.z * v1.x - v0.x * v1.z;\n    v.z = v0.x * v1.y - v0.y * v1.x;\n};\nVector3.normalize = function (v) {\n    var l = v.x * v.x + v.y * v.y + v.z * v.z;\n    if(l > 0.00001) {\n        l = 1.0 / Math.sqrt(l);\n        v.x *= l;\n        v.y *= l;\n        v.z *= l;\n    }\n};\nVector3.arrayForm = function(v) {\n    if(v.array) {\n        v.array[0] = v.x;\n        v.array[1] = v.y;\n        v.array[2] = v.z;\n    }\n    else {\n        v.array = new Float32Array([v.x, v.y, v.z]);\n    }\n    return v.array;\n};\nMatrix44.createIdentity = function () {\n    return new Float32Array([1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);\n};\nMatrix44.loadProjection = function (m, aspect, vdeg, near, far) {\n    var h = near * Math.tan(vdeg * Math.PI / 180.0 * 0.5) * 2.0;\n    var w = h * aspect;\n    \n    m[0] = 2.0 * near / w;\n    m[1] = 0.0;\n    m[2] = 0.0;\n    m[3] = 0.0;\n    \n    m[4] = 0.0;\n    m[5] = 2.0 * near / h;\n    m[6] = 0.0;\n    m[7] = 0.0;\n    \n    m[8] = 0.0;\n    m[9] = 0.0;\n    m[10] = -(far + near) / (far - near);\n    m[11] = -1.0;\n    \n    m[12] = 0.0;\n    m[13] = 0.0;\n    m[14] = -2.0 * far * near / (far - near);\n    m[15] = 0.0;\n};\nMatrix44.loadLookAt = function (m, vpos, vlook, vup) {\n    var frontv = Vector3.create(vpos.x - vlook.x, vpos.y - vlook.y, vpos.z - vlook.z);\n    Vector3.normalize(frontv);\n    var sidev = Vector3.create(1.0, 0.0, 0.0);\n    Vector3.cross(sidev, vup, frontv);\n    Vector3.normalize(sidev);\n    var topv = Vector3.create(1.0, 0.0, 0.0);\n    Vector3.cross(topv, frontv, sidev);\n    Vector3.normalize(topv);\n    \n    m[0] = sidev.x;\n    m[1] = topv.x;\n    m[2] = frontv.x;\n    m[3] = 0.0;\n    \n    m[4] = sidev.y;\n    m[5] = topv.y;\n    m[6] = frontv.y;\n    m[7] = 0.0;\n    \n    m[8] = sidev.z;\n    m[9] = topv.z;\n    m[10] = frontv.z;\n    m[11] = 0.0;\n    \n    m[12] = -(vpos.x * m[0] + vpos.y * m[4] + vpos.z * m[8]);\n    m[13] = -(vpos.x * m[1] + vpos.y * m[5] + vpos.z * m[9]);\n    m[14] = -(vpos.x * m[2] + vpos.y * m[6] + vpos.z * m[10]);\n    m[15] = 1.0;\n};\n\n//\nvar timeInfo = {\n    'start':0, 'prev':0, // Date\n    'delta':0, 'elapsed':0 // Number(sec)\n};\n\n//\nvar gl;\nvar renderSpec = {\n    'width':0,\n    'height':0,\n    'aspect':1,\n    'array':new Float32Array(3),\n    'halfWidth':0,\n    'halfHeight':0,\n    'halfArray':new Float32Array(3)\n    // and some render targets. see setViewport()\n};\nrenderSpec.setSize = function(w, h) {\n    renderSpec.width = w;\n    renderSpec.height = h;\n    renderSpec.aspect = renderSpec.width / renderSpec.height;\n    renderSpec.array[0] = renderSpec.width;\n    renderSpec.array[1] = renderSpec.height;\n    renderSpec.array[2] = renderSpec.aspect;\n    \n    renderSpec.halfWidth = Math.floor(w / 2);\n    renderSpec.halfHeight = Math.floor(h / 2);\n    renderSpec.halfArray[0] = renderSpec.halfWidth;\n    renderSpec.halfArray[1] = renderSpec.halfHeight;\n    renderSpec.halfArray[2] = renderSpec.halfWidth / renderSpec.halfHeight;\n};\n\nfunction deleteRenderTarget(rt) {\n    gl.deleteFramebuffer(rt.frameBuffer);\n    gl.deleteRenderbuffer(rt.renderBuffer);\n    gl.deleteTexture(rt.texture);\n}\n\nfunction createRenderTarget(w, h) {\n    var ret = {\n        'width':w,\n        'height':h,\n        'sizeArray':new Float32Array([w, h, w / h]),\n        'dtxArray':new Float32Array([1.0 / w, 1.0 / h])\n    };\n    ret.frameBuffer = gl.createFramebuffer();\n    ret.renderBuffer = gl.createRenderbuffer();\n    ret.texture = gl.createTexture();\n    \n    gl.bindTexture(gl.TEXTURE_2D, ret.texture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    \n    gl.bindFramebuffer(gl.FRAMEBUFFER, ret.frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, ret.texture, 0);\n    \n    gl.bindRenderbuffer(gl.RENDERBUFFER, ret.renderBuffer);\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);\n    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, ret.renderBuffer);\n    \n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    \n    return ret;\n}\n\nfunction compileShader(shtype, shsrc) {\n\tvar retsh = gl.createShader(shtype);\n\t\n\tgl.shaderSource(retsh, shsrc);\n\tgl.compileShader(retsh);\n\t\n\tif(!gl.getShaderParameter(retsh, gl.COMPILE_STATUS)) {\n\t\tvar errlog = gl.getShaderInfoLog(retsh);\n\t\tgl.deleteShader(retsh);\n\t\tconsole.error(errlog);\n\t\treturn null;\n\t}\n\treturn retsh;\n}\n\nfunction createShader(vtxsrc, frgsrc, uniformlist, attrlist) {\n    var vsh = compileShader(gl.VERTEX_SHADER, vtxsrc);\n    var fsh = compileShader(gl.FRAGMENT_SHADER, frgsrc);\n    \n    if(vsh == null || fsh == null) {\n        return null;\n    }\n    \n    var prog = gl.createProgram();\n    gl.attachShader(prog, vsh);\n    gl.attachShader(prog, fsh);\n    \n    gl.deleteShader(vsh);\n    gl.deleteShader(fsh);\n    \n    gl.linkProgram(prog);\n    if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\n        var errlog = gl.getProgramInfoLog(prog);\n        console.error(errlog);\n        return null;\n    }\n    \n    if(uniformlist) {\n        prog.uniforms = {};\n        for(var i = 0; i < uniformlist.length; i++) {\n            prog.uniforms[uniformlist[i]] = gl.getUniformLocation(prog, uniformlist[i]);\n        }\n    }\n    \n    if(attrlist) {\n        prog.attributes = {};\n        for(var i = 0; i < attrlist.length; i++) {\n            var attr = attrlist[i];\n            prog.attributes[attr] = gl.getAttribLocation(prog, attr);\n        }\n    }\n    \n    return prog;\n}\n\nfunction useShader(prog) {\n    gl.useProgram(prog);\n    for(var attr in prog.attributes) {\n        gl.enableVertexAttribArray(prog.attributes[attr]);;\n    }\n}\n\nfunction unuseShader(prog) {\n    for(var attr in prog.attributes) {\n        gl.disableVertexAttribArray(prog.attributes[attr]);;\n    }\n    gl.useProgram(null);\n}\n\n/////\nvar projection = {\n    'angle':60,\n    'nearfar':new Float32Array([0.1, 100.0]),\n    'matrix':Matrix44.createIdentity()\n};\nvar camera = {\n    'position':Vector3.create(0, 0, 100),\n    'lookat':Vector3.create(0, 0, 0),\n    'up':Vector3.create(0, 1, 0),\n    'dof':Vector3.create(10.0, 4.0, 8.0),\n    'matrix':Matrix44.createIdentity()\n};\n\nvar pointFlower = {};\nvar meshFlower = {};\nvar sceneStandBy = false;\n\nvar BlossomParticle = function () {\n    this.velocity = new Array(3);\n    this.rotation = new Array(3);\n    this.position = new Array(3);\n    this.euler = new Array(3);\n    this.size = 1.0;\n    this.alpha = 1.0;\n    this.zkey = 0.0;\n};\n\nBlossomParticle.prototype.setVelocity = function (vx, vy, vz) {\n    this.velocity[0] = vx;\n    this.velocity[1] = vy;\n    this.velocity[2] = vz;\n};\n\nBlossomParticle.prototype.setRotation = function (rx, ry, rz) {\n    this.rotation[0] = rx;\n    this.rotation[1] = ry;\n    this.rotation[2] = rz;\n};\n\nBlossomParticle.prototype.setPosition = function (nx, ny, nz) {\n    this.position[0] = nx;\n    this.position[1] = ny;\n    this.position[2] = nz;\n};\n\nBlossomParticle.prototype.setEulerAngles = function (rx, ry, rz) {\n    this.euler[0] = rx;\n    this.euler[1] = ry;\n    this.euler[2] = rz;\n};\n\nBlossomParticle.prototype.setSize = function (s) {\n    this.size = s;\n};\n\nBlossomParticle.prototype.update = function (dt, et) {\n    this.position[0] += this.velocity[0] * dt;\n    this.position[1] += this.velocity[1] * dt;\n    this.position[2] += this.velocity[2] * dt;\n    \n    this.euler[0] += this.rotation[0] * dt;\n    this.euler[1] += this.rotation[1] * dt;\n    this.euler[2] += this.rotation[2] * dt;\n};\n\nfunction createPointFlowers() {\n    // get point sizes\n    var prm = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);\n    renderSpec.pointSize = {'min':prm[0], 'max':prm[1]};\n    \n    var vtxsrc = document.getElementById(\"sakura_point_vsh\").textContent;\n    var frgsrc = document.getElementById(\"sakura_point_fsh\").textContent;\n    \n    pointFlower.program = createShader(\n        vtxsrc, frgsrc,\n        ['uProjection', 'uModelview', 'uResolution', 'uOffset', 'uDOF', 'uFade'],\n        ['aPosition', 'aEuler', 'aMisc']\n    );\n    \n    useShader(pointFlower.program);\n    pointFlower.offset = new Float32Array([0.0, 0.0, 0.0]);\n    pointFlower.fader = Vector3.create(0.0, 10.0, 0.0);\n    \n    // paramerters: velocity[3], rotate[3]\n    pointFlower.numFlowers = 1600;\n    pointFlower.particles = new Array(pointFlower.numFlowers);\n    // vertex attributes {position[3], euler_xyz[3], size[1]}\n    pointFlower.dataArray = new Float32Array(pointFlower.numFlowers * (3 + 3 + 2));\n    pointFlower.positionArrayOffset = 0;\n    pointFlower.eulerArrayOffset = pointFlower.numFlowers * 3;\n    pointFlower.miscArrayOffset = pointFlower.numFlowers * 6;\n    \n    pointFlower.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    \n    unuseShader(pointFlower.program);\n    \n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        pointFlower.particles[i] = new BlossomParticle();\n    }\n}\n\nfunction initPointFlowers() {\n    //area\n    pointFlower.area = Vector3.create(20.0, 20.0, 20.0);\n    pointFlower.area.x = pointFlower.area.y * renderSpec.aspect;\n    \n    pointFlower.fader.x = 10.0; //env fade start\n    pointFlower.fader.y = pointFlower.area.z; //env fade half\n    pointFlower.fader.z = 0.1;  //near fade start\n    \n    //particles\n    var PI2 = Math.PI * 2.0;\n    var tmpv3 = Vector3.create(0, 0, 0);\n    var tmpv = 0;\n    var symmetryrand = function() {return (Math.random() * 2.0 - 1.0);};\n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var tmpprtcl = pointFlower.particles[i];\n        \n        //velocity\n        tmpv3.x = symmetryrand() * 0.3 + 0.8;\n        tmpv3.y = symmetryrand() * 0.2 - 1.0;\n        tmpv3.z = symmetryrand() * 0.3 + 0.5;\n        Vector3.normalize(tmpv3);\n        tmpv = 2.0 + Math.random() * 1.0;\n        tmpprtcl.setVelocity(tmpv3.x * tmpv, tmpv3.y * tmpv, tmpv3.z * tmpv);\n        \n        //rotation\n        tmpprtcl.setRotation(\n            symmetryrand() * PI2 * 0.5,\n            symmetryrand() * PI2 * 0.5,\n            symmetryrand() * PI2 * 0.5\n        );\n        \n        //position\n        tmpprtcl.setPosition(\n            symmetryrand() * pointFlower.area.x,\n            symmetryrand() * pointFlower.area.y,\n            symmetryrand() * pointFlower.area.z\n        );\n        \n        //euler\n        tmpprtcl.setEulerAngles(\n            Math.random() * Math.PI * 2.0,\n            Math.random() * Math.PI * 2.0,\n            Math.random() * Math.PI * 2.0\n        );\n        \n        //size\n        tmpprtcl.setSize(0.9 + Math.random() * 0.1);\n    }\n}\n\nfunction renderPointFlowers() {\n    //update\n    var PI2 = Math.PI * 2.0;\n    var limit = [pointFlower.area.x, pointFlower.area.y, pointFlower.area.z];\n    var repeatPos = function (prt, cmp, limit) {\n        if(Math.abs(prt.position[cmp]) - prt.size * 0.5 > limit) {\n            //out of area\n            if(prt.position[cmp] > 0) {\n                prt.position[cmp] -= limit * 2.0;\n            }\n            else {\n                prt.position[cmp] += limit * 2.0;\n            }\n        }\n    };\n    var repeatEuler = function (prt, cmp) {\n        prt.euler[cmp] = prt.euler[cmp] % PI2;\n        if(prt.euler[cmp] < 0.0) {\n            prt.euler[cmp] += PI2;\n        }\n    };\n    \n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var prtcl = pointFlower.particles[i];\n        prtcl.update(timeInfo.delta, timeInfo.elapsed);\n        repeatPos(prtcl, 0, pointFlower.area.x);\n        repeatPos(prtcl, 1, pointFlower.area.y);\n        repeatPos(prtcl, 2, pointFlower.area.z);\n        repeatEuler(prtcl, 0);\n        repeatEuler(prtcl, 1);\n        repeatEuler(prtcl, 2);\n        \n        prtcl.alpha = 1.0;//(pointFlower.area.z - prtcl.position[2]) * 0.5;\n        \n        prtcl.zkey = (camera.matrix[2] * prtcl.position[0]\n                    + camera.matrix[6] * prtcl.position[1]\n                    + camera.matrix[10] * prtcl.position[2]\n                    + camera.matrix[14]);\n    }\n    \n    // sort\n    pointFlower.particles.sort(function(p0, p1){return p0.zkey - p1.zkey;});\n    \n    // update data\n    var ipos = pointFlower.positionArrayOffset;\n    var ieuler = pointFlower.eulerArrayOffset;\n    var imisc = pointFlower.miscArrayOffset;\n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var prtcl = pointFlower.particles[i];\n        pointFlower.dataArray[ipos] = prtcl.position[0];\n        pointFlower.dataArray[ipos + 1] = prtcl.position[1];\n        pointFlower.dataArray[ipos + 2] = prtcl.position[2];\n        ipos += 3;\n        pointFlower.dataArray[ieuler] = prtcl.euler[0];\n        pointFlower.dataArray[ieuler + 1] = prtcl.euler[1];\n        pointFlower.dataArray[ieuler + 2] = prtcl.euler[2];\n        ieuler += 3;\n        pointFlower.dataArray[imisc] = prtcl.size;\n        pointFlower.dataArray[imisc + 1] = prtcl.alpha;\n        imisc += 2;\n    }\n    \n    //draw\n    gl.enable(gl.BLEND);\n    //gl.disable(gl.DEPTH_TEST);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    \n    var prog = pointFlower.program;\n    useShader(prog);\n    \n    gl.uniformMatrix4fv(prog.uniforms.uProjection, false, projection.matrix);\n    gl.uniformMatrix4fv(prog.uniforms.uModelview, false, camera.matrix);\n    gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\n    gl.uniform3fv(prog.uniforms.uDOF, Vector3.arrayForm(camera.dof));\n    gl.uniform3fv(prog.uniforms.uFade, Vector3.arrayForm(pointFlower.fader));\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\n    \n    gl.vertexAttribPointer(prog.attributes.aPosition, 3, gl.FLOAT, false, 0, pointFlower.positionArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    gl.vertexAttribPointer(prog.attributes.aEuler, 3, gl.FLOAT, false, 0, pointFlower.eulerArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    gl.vertexAttribPointer(prog.attributes.aMisc, 2, gl.FLOAT, false, 0, pointFlower.miscArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    \n    // doubler\n    for(var i = 1; i < 2; i++) {\n        var zpos = i * -2.0;\n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\n        pointFlower.offset[1] = pointFlower.area.y *  1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x *  1.0;\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x *  1.0;\n        pointFlower.offset[1] = pointFlower.area.y *  1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n    }\n    \n    //main\n    pointFlower.offset[0] = 0.0;\n    pointFlower.offset[1] = 0.0;\n    pointFlower.offset[2] = 0.0;\n    gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n    gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    unuseShader(prog);\n    \n    gl.enable(gl.DEPTH_TEST);\n    gl.disable(gl.BLEND);\n}\n\n// effects\n//common util\nfunction createEffectProgram(vtxsrc, frgsrc, exunifs, exattrs) {\n    var ret = {};\n    var unifs = ['uResolution', 'uSrc', 'uDelta'];\n    if(exunifs) {\n        unifs = unifs.concat(exunifs);\n    }\n    var attrs = ['aPosition'];\n    if(exattrs) {\n        attrs = attrs.concat(exattrs);\n    }\n    \n    ret.program = createShader(vtxsrc, frgsrc, unifs, attrs);\n    useShader(ret.program);\n    \n    ret.dataArray = new Float32Array([\n        -1.0, -1.0,\n         1.0, -1.0,\n        -1.0,  1.0,\n         1.0,  1.0\n    ]);\n    ret.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, ret.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, ret.dataArray, gl.STATIC_DRAW);\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    unuseShader(ret.program);\n    \n    return ret;\n}\n\n// basic usage\n// useEffect(prog, srctex({'texture':texid, 'dtxArray':(f32)[dtx, dty]})); //basic initialize\n// gl.uniform**(...); //additional uniforms\n// drawEffect()\n// unuseEffect(prog)\n// TEXTURE0 makes src\nfunction useEffect(fxobj, srctex) {\n    var prog = fxobj.program;\n    useShader(prog);\n    gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\n    \n    if(srctex != null) {\n        gl.uniform2fv(prog.uniforms.uDelta, srctex.dtxArray);\n        gl.uniform1i(prog.uniforms.uSrc, 0);\n        \n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, srctex.texture);\n    }\n}\nfunction drawEffect(fxobj) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, fxobj.buffer);\n    gl.vertexAttribPointer(fxobj.program.attributes.aPosition, 2, gl.FLOAT, false, 0, 0);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\nfunction unuseEffect(fxobj) {\n    unuseShader(fxobj.program);\n}\n\nvar effectLib = {};\nfunction createEffectLib() {\n    \n    var vtxsrc, frgsrc;\n    //common\n    var cmnvtxsrc = document.getElementById(\"fx_common_vsh\").textContent;\n    \n    //background\n    frgsrc = document.getElementById(\"bg_fsh\").textContent;\n    effectLib.sceneBg = createEffectProgram(cmnvtxsrc, frgsrc, ['uTimes'], null);\n    \n    // make brightpixels buffer\n    frgsrc = document.getElementById(\"fx_brightbuf_fsh\").textContent;\n    effectLib.mkBrightBuf = createEffectProgram(cmnvtxsrc, frgsrc, null, null);\n    \n    // direction blur\n    frgsrc = document.getElementById(\"fx_dirblur_r4_fsh\").textContent;\n    effectLib.dirBlur = createEffectProgram(cmnvtxsrc, frgsrc, ['uBlurDir'], null);\n    \n    //final composite\n    vtxsrc = document.getElementById(\"pp_final_vsh\").textContent;\n    frgsrc = document.getElementById(\"pp_final_fsh\").textContent;\n    effectLib.finalComp = createEffectProgram(vtxsrc, frgsrc, ['uBloom'], null);\n}\n\n// background\nfunction createBackground() {\n    //console.log(\"create background\");\n}\nfunction initBackground() {\n    //console.log(\"init background\");\n}\nfunction renderBackground() {\n    gl.disable(gl.DEPTH_TEST);\n    \n    useEffect(effectLib.sceneBg, null);\n    gl.uniform2f(effectLib.sceneBg.program.uniforms.uTimes, timeInfo.elapsed, timeInfo.delta);\n    drawEffect(effectLib.sceneBg);\n    unuseEffect(effectLib.sceneBg);\n    \n    gl.enable(gl.DEPTH_TEST);\n}\n\n// post process\nvar postProcess = {};\nfunction createPostProcess() {\n    //console.log(\"create post process\");\n}\nfunction initPostProcess() {\n    //console.log(\"init post process\");\n}\n\nfunction renderPostProcess() {\n    gl.enable(gl.TEXTURE_2D);\n    gl.disable(gl.DEPTH_TEST);\n    var bindRT = function (rt, isclear) {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, rt.frameBuffer);\n        gl.viewport(0, 0, rt.width, rt.height);\n        if(isclear) {\n            gl.clearColor(0, 0, 0, 0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n    };\n    \n    //make bright buff\n    bindRT(renderSpec.wHalfRT0, true);\n    useEffect(effectLib.mkBrightBuf, renderSpec.mainRT);\n    drawEffect(effectLib.mkBrightBuf);\n    unuseEffect(effectLib.mkBrightBuf);\n    \n    // make bloom\n    for(var i = 0; i < 2; i++) {\n        var p = 1.5 + 1 * i;\n        var s = 2.0 + 1 * i;\n        bindRT(renderSpec.wHalfRT1, true);\n        useEffect(effectLib.dirBlur, renderSpec.wHalfRT0);\n        gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, p, 0.0, s, 0.0);\n        drawEffect(effectLib.dirBlur);\n        unuseEffect(effectLib.dirBlur);\n        \n        bindRT(renderSpec.wHalfRT0, true);\n        useEffect(effectLib.dirBlur, renderSpec.wHalfRT1);\n        gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, 0.0, p, 0.0, s);\n        drawEffect(effectLib.dirBlur);\n        unuseEffect(effectLib.dirBlur);\n    }\n    \n    //display\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, renderSpec.width, renderSpec.height);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    \n    useEffect(effectLib.finalComp, renderSpec.mainRT);\n    gl.uniform1i(effectLib.finalComp.program.uniforms.uBloom, 1);\n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, renderSpec.wHalfRT0.texture);\n    drawEffect(effectLib.finalComp);\n    unuseEffect(effectLib.finalComp);\n    \n    gl.enable(gl.DEPTH_TEST);\n}\n\n/////\nvar SceneEnv = {};\nfunction createScene() {\n    createEffectLib();\n    createBackground();\n    createPointFlowers();\n    createPostProcess();\n    sceneStandBy = true;\n}\n\nfunction initScene() {\n    initBackground();\n    initPointFlowers();\n    initPostProcess();\n    \n    //camera.position.z = 17.320508;\n    camera.position.z = pointFlower.area.z + projection.nearfar[0];\n    projection.angle = Math.atan2(pointFlower.area.y, camera.position.z + pointFlower.area.z) * 180.0 / Math.PI * 2.0;\n    Matrix44.loadProjection(projection.matrix, renderSpec.aspect, projection.angle, projection.nearfar[0], projection.nearfar[1]);\n}\n\nfunction renderScene() {\n    //draw\n    Matrix44.loadLookAt(camera.matrix, camera.position, camera.lookat, camera.up);\n    \n    gl.enable(gl.DEPTH_TEST);\n    \n    //gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, renderSpec.mainRT.frameBuffer);\n    gl.viewport(0, 0, renderSpec.mainRT.width, renderSpec.mainRT.height);\n    gl.clearColor(0.005, 0, 0.05, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    \n    renderBackground();\n    renderPointFlowers();\n    renderPostProcess();\n}\n\n/////\nfunction onResize(e) {\n    makeCanvasFullScreen(document.getElementById(\"sakura\"));\n    setViewports();\n    if(sceneStandBy) {\n        initScene();\n    }\n}\n\nfunction setViewports() {\n    renderSpec.setSize(gl.canvas.width, gl.canvas.height);\n    \n    gl.clearColor(0.2, 0.2, 0.5, 1.0);\n    gl.viewport(0, 0, renderSpec.width, renderSpec.height);\n    \n    var rtfunc = function (rtname, rtw, rth) {\n        var rt = renderSpec[rtname];\n        if(rt) deleteRenderTarget(rt);\n        renderSpec[rtname] = createRenderTarget(rtw, rth);\n    };\n    rtfunc('mainRT', renderSpec.width, renderSpec.height);\n    rtfunc('wFullRT0', renderSpec.width, renderSpec.height);\n    rtfunc('wFullRT1', renderSpec.width, renderSpec.height);\n    rtfunc('wHalfRT0', renderSpec.halfWidth, renderSpec.halfHeight);\n    rtfunc('wHalfRT1', renderSpec.halfWidth, renderSpec.halfHeight);\n}\n\nfunction render() {\n    renderScene();\n}\n\nvar animating = true;\nfunction toggleAnimation(elm) {\n    animating ^= true;\n    if(animating) animate();\n    if(elm) {\n        elm.innerHTML = animating? \"Stop\":\"Start\";\n    }\n}\n\nfunction stepAnimation() {\n    if(!animating) animate();\n}\n\nfunction animate() {\n    var curdate = new Date();\n    timeInfo.elapsed = (curdate - timeInfo.start) / 1000.0;\n    timeInfo.delta = (curdate - timeInfo.prev) / 1000.0;\n    timeInfo.prev = curdate;\n    \n    if(animating) requestAnimationFrame(animate);\n    render();\n}\n\nfunction makeCanvasFullScreen(canvas) {\n    var b = document.body;\n\tvar d = document.documentElement;\n\tfullw = Math.max(b.clientWidth , b.scrollWidth, d.scrollWidth, d.clientWidth);\n\tfullh = Math.max(b.clientHeight , b.scrollHeight, d.scrollHeight, d.clientHeight);\n\tcanvas.width = fullw;\n\tcanvas.height = fullh;\n}\n\nwindow.addEventListener('load', function(e) {\n    var canvas = document.getElementById(\"sakura\");\n    try {\n        makeCanvasFullScreen(canvas);\n        gl = canvas.getContext('experimental-webgl');\n    } catch(e) {\n        alert(\"WebGL not supported.\" + e);\n        console.error(e);\n        return;\n    }\n    \n    window.addEventListener('resize', onResize);\n    \n    setViewports();\n    createScene();\n    initScene();\n    \n    timeInfo.start = new Date();\n    timeInfo.prev = timeInfo.start;\n    animate();\n});\n\n//set window.requestAnimationFrame\n(function (w, r) {\n    w['r'+r] = w['r'+r] || w['webkitR'+r] || w['mozR'+r] || w['msR'+r] || w['oR'+r] || function(c){ w.setTimeout(c, 1000 / 60); };\n})(window, 'equestAnimationFrame');"]}