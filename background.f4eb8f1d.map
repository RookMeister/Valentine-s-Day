{"version":3,"sources":["src/background.js"],"names":["Vector3","Matrix44","create","x","y","z","dot","v0","v1","cross","v","normalize","l","Math","sqrt","arrayForm","array","Float32Array","createIdentity","loadProjection","m","aspect","vdeg","near","far","h","tan","PI","w","loadLookAt","vpos","vlook","vup","frontv","sidev","topv","timeInfo","gl","renderSpec","setSize","width","height","halfWidth","floor","halfHeight","halfArray","deleteRenderTarget","rt","deleteFramebuffer","frameBuffer","deleteRenderbuffer","renderBuffer","deleteTexture","texture","createRenderTarget","ret","createFramebuffer","createRenderbuffer","createTexture","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","framebufferRenderbuffer","DEPTH_ATTACHMENT","compileShader","shtype","shsrc","retsh","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","errlog","getShaderInfoLog","deleteShader","console","error","vtxsrc","frgsrc","uniformlist","attrlist","vsh","VERTEX_SHADER","fsh","FRAGMENT_SHADER","prog","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniforms","i","length","getUniformLocation","attributes","attr","getAttribLocation","useShader","useProgram","enableVertexAttribArray","unuseShader","disableVertexAttribArray","projection","camera","pointFlower","meshFlower","sceneStandBy","BlossomParticle","velocity","Array","rotation","position","euler","size","alpha","zkey","prototype","setVelocity","vx","vy","vz","setRotation","rx","ry","rz","setPosition","nx","ny","nz","setEulerAngles","s","update","dt","et","createPointFlowers","prm","getParameter","ALIASED_POINT_SIZE_RANGE","pointSize","document","getElementById","textContent","program","offset","fader","numFlowers","particles","dataArray","positionArrayOffset","eulerArrayOffset","miscArrayOffset","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","DYNAMIC_DRAW","initPointFlowers","area","PI2","tmpv3","tmpv","symmetryrand","random","tmpprtcl","renderPointFlowers","limit","repeatPos","prt","cmp","abs","repeatEuler","prtcl","delta","elapsed","matrix","sort","p0","p1","ipos","ieuler","imisc","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","uniformMatrix4fv","uProjection","uModelview","uniform3fv","uResolution","uDOF","dof","uFade","vertexAttribPointer","aPosition","FLOAT","BYTES_PER_ELEMENT","aEuler","aMisc","zpos","uOffset","drawArrays","POINT","DEPTH_TEST","disable","createEffectProgram","exunifs","exattrs","unifs","concat","attrs","STATIC_DRAW","useEffect","fxobj","srctex","uniform2fv","uDelta","dtxArray","uniform1i","uSrc","activeTexture","TEXTURE0","drawEffect","TRIANGLE_STRIP","unuseEffect","effectLib","createEffectLib","cmnvtxsrc","sceneBg","mkBrightBuf","dirBlur","finalComp","createBackground","initBackground","renderBackground","uniform2f","uTimes","postProcess","createPostProcess","initPostProcess","renderPostProcess","bindRT","isclear","viewport","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","wHalfRT0","mainRT","p","wHalfRT1","uniform4f","uBlurDir","uBloom","TEXTURE1","SceneEnv","createScene","initScene","nearfar","angle","atan2","renderScene","lookat","up","onResize","e","makeCanvasFullScreen","setViewports","canvas","rtfunc","rtname","rtw","rth","render","animating","toggleAnimation","elm","animate","innerHTML","stepAnimation","curdate","Date","start","prev","requestAnimationFrame","b","body","d","documentElement","fullw","max","clientWidth","scrollWidth","fullh","clientHeight","scrollHeight","window","addEventListener","getContext","alert","r","c","setTimeout"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA,IAAIA,OAAO,GAAG,EAAd;AACA,IAAIC,QAAQ,GAAG,EAAf;;AACAD,OAAO,CAACE,MAAR,GAAiB,UAASC,CAAT,EAAYC,CAAZ,EAAeC,CAAf,EAAkB;AAC/B,SAAO;AAAC,SAAIF,CAAL;AAAQ,SAAIC,CAAZ;AAAe,SAAIC;AAAnB,GAAP;AACH,CAFD;;AAGAL,OAAO,CAACM,GAAR,GAAc,UAAUC,EAAV,EAAcC,EAAd,EAAkB;AAC5B,SAAOD,EAAE,CAACJ,CAAH,GAAOK,EAAE,CAACL,CAAV,GAAcI,EAAE,CAACH,CAAH,GAAOI,EAAE,CAACJ,CAAxB,GAA4BG,EAAE,CAACF,CAAH,GAAOG,EAAE,CAACH,CAA7C;AACH,CAFD;;AAGAL,OAAO,CAACS,KAAR,GAAgB,UAAUC,CAAV,EAAaH,EAAb,EAAiBC,EAAjB,EAAqB;AACjCE,EAAAA,CAAC,CAACP,CAAF,GAAMI,EAAE,CAACH,CAAH,GAAOI,EAAE,CAACH,CAAV,GAAcE,EAAE,CAACF,CAAH,GAAOG,EAAE,CAACJ,CAA9B;AACAM,EAAAA,CAAC,CAACN,CAAF,GAAMG,EAAE,CAACF,CAAH,GAAOG,EAAE,CAACL,CAAV,GAAcI,EAAE,CAACJ,CAAH,GAAOK,EAAE,CAACH,CAA9B;AACAK,EAAAA,CAAC,CAACL,CAAF,GAAME,EAAE,CAACJ,CAAH,GAAOK,EAAE,CAACJ,CAAV,GAAcG,EAAE,CAACH,CAAH,GAAOI,EAAE,CAACL,CAA9B;AACH,CAJD;;AAKAH,OAAO,CAACW,SAAR,GAAoB,UAAUD,CAAV,EAAa;AAC7B,MAAIE,CAAC,GAAGF,CAAC,CAACP,CAAF,GAAMO,CAAC,CAACP,CAAR,GAAYO,CAAC,CAACN,CAAF,GAAMM,CAAC,CAACN,CAApB,GAAwBM,CAAC,CAACL,CAAF,GAAMK,CAAC,CAACL,CAAxC;;AACA,MAAGO,CAAC,GAAG,OAAP,EAAgB;AACZA,IAAAA,CAAC,GAAG,MAAMC,IAAI,CAACC,IAAL,CAAUF,CAAV,CAAV;AACAF,IAAAA,CAAC,CAACP,CAAF,IAAOS,CAAP;AACAF,IAAAA,CAAC,CAACN,CAAF,IAAOQ,CAAP;AACAF,IAAAA,CAAC,CAACL,CAAF,IAAOO,CAAP;AACH;AACJ,CARD;;AASAZ,OAAO,CAACe,SAAR,GAAoB,UAASL,CAAT,EAAY;AAC5B,MAAGA,CAAC,CAACM,KAAL,EAAY;AACRN,IAAAA,CAAC,CAACM,KAAF,CAAQ,CAAR,IAAaN,CAAC,CAACP,CAAf;AACAO,IAAAA,CAAC,CAACM,KAAF,CAAQ,CAAR,IAAaN,CAAC,CAACN,CAAf;AACAM,IAAAA,CAAC,CAACM,KAAF,CAAQ,CAAR,IAAaN,CAAC,CAACL,CAAf;AACH,GAJD,MAKK;AACDK,IAAAA,CAAC,CAACM,KAAF,GAAU,IAAIC,YAAJ,CAAiB,CAACP,CAAC,CAACP,CAAH,EAAMO,CAAC,CAACN,CAAR,EAAWM,CAAC,CAACL,CAAb,CAAjB,CAAV;AACH;;AACD,SAAOK,CAAC,CAACM,KAAT;AACH,CAVD;;AAWAf,QAAQ,CAACiB,cAAT,GAA0B,YAAY;AAClC,SAAO,IAAID,YAAJ,CAAiB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,EAA0B,GAA1B,EAA+B,GAA/B,EAAoC,GAApC,EAAyC,GAAzC,EAA8C,GAA9C,EAAmD,GAAnD,EAAwD,GAAxD,EAA6D,GAA7D,EAAkE,GAAlE,EAAuE,GAAvE,EAA4E,GAA5E,CAAjB,CAAP;AACH,CAFD;;AAGAhB,QAAQ,CAACkB,cAAT,GAA0B,UAAUC,CAAV,EAAaC,MAAb,EAAqBC,IAArB,EAA2BC,IAA3B,EAAiCC,GAAjC,EAAsC;AAC5D,MAAIC,CAAC,GAAGF,IAAI,GAAGV,IAAI,CAACa,GAAL,CAASJ,IAAI,GAAGT,IAAI,CAACc,EAAZ,GAAiB,KAAjB,GAAyB,GAAlC,CAAP,GAAgD,GAAxD;AACA,MAAIC,CAAC,GAAGH,CAAC,GAAGJ,MAAZ;AAEAD,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,MAAMG,IAAN,GAAaK,CAApB;AACAR,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AAEAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,MAAMG,IAAN,GAAaE,CAApB;AACAL,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AAEAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,EAAEI,GAAG,GAAGD,IAAR,KAAiBC,GAAG,GAAGD,IAAvB,CAAR;AACAH,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,CAAC,GAAT;AAEAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,GAAR;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,GAAR;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,CAAC,GAAD,GAAOI,GAAP,GAAaD,IAAb,IAAqBC,GAAG,GAAGD,IAA3B,CAAR;AACAH,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,GAAR;AACH,CAvBD;;AAwBAnB,QAAQ,CAAC4B,UAAT,GAAsB,UAAUT,CAAV,EAAaU,IAAb,EAAmBC,KAAnB,EAA0BC,GAA1B,EAA+B;AACjD,MAAIC,MAAM,GAAGjC,OAAO,CAACE,MAAR,CAAe4B,IAAI,CAAC3B,CAAL,GAAS4B,KAAK,CAAC5B,CAA9B,EAAiC2B,IAAI,CAAC1B,CAAL,GAAS2B,KAAK,CAAC3B,CAAhD,EAAmD0B,IAAI,CAACzB,CAAL,GAAS0B,KAAK,CAAC1B,CAAlE,CAAb;AACAL,EAAAA,OAAO,CAACW,SAAR,CAAkBsB,MAAlB;AACA,MAAIC,KAAK,GAAGlC,OAAO,CAACE,MAAR,CAAe,GAAf,EAAoB,GAApB,EAAyB,GAAzB,CAAZ;AACAF,EAAAA,OAAO,CAACS,KAAR,CAAcyB,KAAd,EAAqBF,GAArB,EAA0BC,MAA1B;AACAjC,EAAAA,OAAO,CAACW,SAAR,CAAkBuB,KAAlB;AACA,MAAIC,IAAI,GAAGnC,OAAO,CAACE,MAAR,CAAe,GAAf,EAAoB,GAApB,EAAyB,GAAzB,CAAX;AACAF,EAAAA,OAAO,CAACS,KAAR,CAAc0B,IAAd,EAAoBF,MAApB,EAA4BC,KAA5B;AACAlC,EAAAA,OAAO,CAACW,SAAR,CAAkBwB,IAAlB;AAEAf,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOc,KAAK,CAAC/B,CAAb;AACAiB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOe,IAAI,CAAChC,CAAZ;AACAiB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOa,MAAM,CAAC9B,CAAd;AACAiB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AAEAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOc,KAAK,CAAC9B,CAAb;AACAgB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOe,IAAI,CAAC/B,CAAZ;AACAgB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOa,MAAM,CAAC7B,CAAd;AACAgB,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAO,GAAP;AAEAA,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOc,KAAK,CAAC7B,CAAb;AACAe,EAAAA,CAAC,CAAC,CAAD,CAAD,GAAOe,IAAI,CAAC9B,CAAZ;AACAe,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQa,MAAM,CAAC5B,CAAf;AACAe,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,GAAR;AAEAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,EAAEU,IAAI,CAAC3B,CAAL,GAASiB,CAAC,CAAC,CAAD,CAAV,GAAgBU,IAAI,CAAC1B,CAAL,GAASgB,CAAC,CAAC,CAAD,CAA1B,GAAgCU,IAAI,CAACzB,CAAL,GAASe,CAAC,CAAC,CAAD,CAA5C,CAAR;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,EAAEU,IAAI,CAAC3B,CAAL,GAASiB,CAAC,CAAC,CAAD,CAAV,GAAgBU,IAAI,CAAC1B,CAAL,GAASgB,CAAC,CAAC,CAAD,CAA1B,GAAgCU,IAAI,CAACzB,CAAL,GAASe,CAAC,CAAC,CAAD,CAA5C,CAAR;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,EAAEU,IAAI,CAAC3B,CAAL,GAASiB,CAAC,CAAC,CAAD,CAAV,GAAgBU,IAAI,CAAC1B,CAAL,GAASgB,CAAC,CAAC,CAAD,CAA1B,GAAgCU,IAAI,CAACzB,CAAL,GAASe,CAAC,CAAC,EAAD,CAA5C,CAAR;AACAA,EAAAA,CAAC,CAAC,EAAD,CAAD,GAAQ,GAAR;AACH,CA7BD,EA+BA;;;AACA,IAAIgB,QAAQ,GAAG;AACX,WAAQ,CADG;AACA,UAAO,CADP;AACU;AACrB,WAAQ,CAFG;AAEA,aAAU,CAFV,CAEY;;AAFZ,CAAf,EAKA;;AACA,IAAIC,EAAJ;AACA,IAAIC,UAAU,GAAG;AACb,WAAQ,CADK;AAEb,YAAS,CAFI;AAGb,YAAS,CAHI;AAIb,WAAQ,IAAIrB,YAAJ,CAAiB,CAAjB,CAJK;AAKb,eAAY,CALC;AAMb,gBAAa,CANA;AAOb,eAAY,IAAIA,YAAJ,CAAiB,CAAjB,CAPC,CAQb;;AARa,CAAjB;;AAUAqB,UAAU,CAACC,OAAX,GAAqB,UAASX,CAAT,EAAYH,CAAZ,EAAe;AAChCa,EAAAA,UAAU,CAACE,KAAX,GAAmBZ,CAAnB;AACAU,EAAAA,UAAU,CAACG,MAAX,GAAoBhB,CAApB;AACAa,EAAAA,UAAU,CAACjB,MAAX,GAAoBiB,UAAU,CAACE,KAAX,GAAmBF,UAAU,CAACG,MAAlD;AACAH,EAAAA,UAAU,CAACtB,KAAX,CAAiB,CAAjB,IAAsBsB,UAAU,CAACE,KAAjC;AACAF,EAAAA,UAAU,CAACtB,KAAX,CAAiB,CAAjB,IAAsBsB,UAAU,CAACG,MAAjC;AACAH,EAAAA,UAAU,CAACtB,KAAX,CAAiB,CAAjB,IAAsBsB,UAAU,CAACjB,MAAjC;AAEAiB,EAAAA,UAAU,CAACI,SAAX,GAAuB7B,IAAI,CAAC8B,KAAL,CAAWf,CAAC,GAAG,CAAf,CAAvB;AACAU,EAAAA,UAAU,CAACM,UAAX,GAAwB/B,IAAI,CAAC8B,KAAL,CAAWlB,CAAC,GAAG,CAAf,CAAxB;AACAa,EAAAA,UAAU,CAACO,SAAX,CAAqB,CAArB,IAA0BP,UAAU,CAACI,SAArC;AACAJ,EAAAA,UAAU,CAACO,SAAX,CAAqB,CAArB,IAA0BP,UAAU,CAACM,UAArC;AACAN,EAAAA,UAAU,CAACO,SAAX,CAAqB,CAArB,IAA0BP,UAAU,CAACI,SAAX,GAAuBJ,UAAU,CAACM,UAA5D;AACH,CAbD;;AAeA,SAASE,kBAAT,CAA4BC,EAA5B,EAAgC;AAC5BV,EAAAA,EAAE,CAACW,iBAAH,CAAqBD,EAAE,CAACE,WAAxB;AACAZ,EAAAA,EAAE,CAACa,kBAAH,CAAsBH,EAAE,CAACI,YAAzB;AACAd,EAAAA,EAAE,CAACe,aAAH,CAAiBL,EAAE,CAACM,OAApB;AACH;;AAED,SAASC,kBAAT,CAA4B1B,CAA5B,EAA+BH,CAA/B,EAAkC;AAC9B,MAAI8B,GAAG,GAAG;AACN,aAAQ3B,CADF;AAEN,cAASH,CAFH;AAGN,iBAAY,IAAIR,YAAJ,CAAiB,CAACW,CAAD,EAAIH,CAAJ,EAAOG,CAAC,GAAGH,CAAX,CAAjB,CAHN;AAIN,gBAAW,IAAIR,YAAJ,CAAiB,CAAC,MAAMW,CAAP,EAAU,MAAMH,CAAhB,CAAjB;AAJL,GAAV;AAMA8B,EAAAA,GAAG,CAACN,WAAJ,GAAkBZ,EAAE,CAACmB,iBAAH,EAAlB;AACAD,EAAAA,GAAG,CAACJ,YAAJ,GAAmBd,EAAE,CAACoB,kBAAH,EAAnB;AACAF,EAAAA,GAAG,CAACF,OAAJ,GAAchB,EAAE,CAACqB,aAAH,EAAd;AAEArB,EAAAA,EAAE,CAACsB,WAAH,CAAetB,EAAE,CAACuB,UAAlB,EAA8BL,GAAG,CAACF,OAAlC;AACAhB,EAAAA,EAAE,CAACwB,UAAH,CAAcxB,EAAE,CAACuB,UAAjB,EAA6B,CAA7B,EAAgCvB,EAAE,CAACyB,IAAnC,EAAyClC,CAAzC,EAA4CH,CAA5C,EAA+C,CAA/C,EAAkDY,EAAE,CAACyB,IAArD,EAA2DzB,EAAE,CAAC0B,aAA9D,EAA6E,IAA7E;AACA1B,EAAAA,EAAE,CAAC2B,aAAH,CAAiB3B,EAAE,CAACuB,UAApB,EAAgCvB,EAAE,CAAC4B,cAAnC,EAAmD5B,EAAE,CAAC6B,aAAtD;AACA7B,EAAAA,EAAE,CAAC2B,aAAH,CAAiB3B,EAAE,CAACuB,UAApB,EAAgCvB,EAAE,CAAC8B,cAAnC,EAAmD9B,EAAE,CAAC6B,aAAtD;AACA7B,EAAAA,EAAE,CAAC2B,aAAH,CAAiB3B,EAAE,CAACuB,UAApB,EAAgCvB,EAAE,CAAC+B,kBAAnC,EAAuD/B,EAAE,CAACgC,MAA1D;AACAhC,EAAAA,EAAE,CAAC2B,aAAH,CAAiB3B,EAAE,CAACuB,UAApB,EAAgCvB,EAAE,CAACiC,kBAAnC,EAAuDjC,EAAE,CAACgC,MAA1D;AAEAhC,EAAAA,EAAE,CAACkC,eAAH,CAAmBlC,EAAE,CAACmC,WAAtB,EAAmCjB,GAAG,CAACN,WAAvC;AACAZ,EAAAA,EAAE,CAACoC,oBAAH,CAAwBpC,EAAE,CAACmC,WAA3B,EAAwCnC,EAAE,CAACqC,iBAA3C,EAA8DrC,EAAE,CAACuB,UAAjE,EAA6EL,GAAG,CAACF,OAAjF,EAA0F,CAA1F;AAEAhB,EAAAA,EAAE,CAACsC,gBAAH,CAAoBtC,EAAE,CAACuC,YAAvB,EAAqCrB,GAAG,CAACJ,YAAzC;AACAd,EAAAA,EAAE,CAACwC,mBAAH,CAAuBxC,EAAE,CAACuC,YAA1B,EAAwCvC,EAAE,CAACyC,iBAA3C,EAA8DlD,CAA9D,EAAiEH,CAAjE;AACAY,EAAAA,EAAE,CAAC0C,uBAAH,CAA2B1C,EAAE,CAACmC,WAA9B,EAA2CnC,EAAE,CAAC2C,gBAA9C,EAAgE3C,EAAE,CAACuC,YAAnE,EAAiFrB,GAAG,CAACJ,YAArF;AAEAd,EAAAA,EAAE,CAACsB,WAAH,CAAetB,EAAE,CAACuB,UAAlB,EAA8B,IAA9B;AACAvB,EAAAA,EAAE,CAACsC,gBAAH,CAAoBtC,EAAE,CAACuC,YAAvB,EAAqC,IAArC;AACAvC,EAAAA,EAAE,CAACkC,eAAH,CAAmBlC,EAAE,CAACmC,WAAtB,EAAmC,IAAnC;AAEA,SAAOjB,GAAP;AACH;;AAED,SAAS0B,aAAT,CAAuBC,MAAvB,EAA+BC,KAA/B,EAAsC;AACrC,MAAIC,KAAK,GAAG/C,EAAE,CAACgD,YAAH,CAAgBH,MAAhB,CAAZ;AAEA7C,EAAAA,EAAE,CAACiD,YAAH,CAAgBF,KAAhB,EAAuBD,KAAvB;AACA9C,EAAAA,EAAE,CAAC4C,aAAH,CAAiBG,KAAjB;;AAEA,MAAG,CAAC/C,EAAE,CAACkD,kBAAH,CAAsBH,KAAtB,EAA6B/C,EAAE,CAACmD,cAAhC,CAAJ,EAAqD;AACpD,QAAIC,MAAM,GAAGpD,EAAE,CAACqD,gBAAH,CAAoBN,KAApB,CAAb;AACA/C,IAAAA,EAAE,CAACsD,YAAH,CAAgBP,KAAhB;AACAQ,IAAAA,OAAO,CAACC,KAAR,CAAcJ,MAAd;AACA,WAAO,IAAP;AACA;;AACD,SAAOL,KAAP;AACA;;AAED,SAASC,YAAT,CAAsBS,MAAtB,EAA8BC,MAA9B,EAAsCC,WAAtC,EAAmDC,QAAnD,EAA6D;AACzD,MAAIC,GAAG,GAAGjB,aAAa,CAAC5C,EAAE,CAAC8D,aAAJ,EAAmBL,MAAnB,CAAvB;AACA,MAAIM,GAAG,GAAGnB,aAAa,CAAC5C,EAAE,CAACgE,eAAJ,EAAqBN,MAArB,CAAvB;;AAEA,MAAGG,GAAG,IAAI,IAAP,IAAeE,GAAG,IAAI,IAAzB,EAA+B;AAC3B,WAAO,IAAP;AACH;;AAED,MAAIE,IAAI,GAAGjE,EAAE,CAACkE,aAAH,EAAX;AACAlE,EAAAA,EAAE,CAACmE,YAAH,CAAgBF,IAAhB,EAAsBJ,GAAtB;AACA7D,EAAAA,EAAE,CAACmE,YAAH,CAAgBF,IAAhB,EAAsBF,GAAtB;AAEA/D,EAAAA,EAAE,CAACsD,YAAH,CAAgBO,GAAhB;AACA7D,EAAAA,EAAE,CAACsD,YAAH,CAAgBS,GAAhB;AAEA/D,EAAAA,EAAE,CAACoE,WAAH,CAAeH,IAAf;;AACA,MAAI,CAACjE,EAAE,CAACqE,mBAAH,CAAuBJ,IAAvB,EAA6BjE,EAAE,CAACsE,WAAhC,CAAL,EAAmD;AAC/C,QAAIlB,MAAM,GAAGpD,EAAE,CAACuE,iBAAH,CAAqBN,IAArB,CAAb;AACAV,IAAAA,OAAO,CAACC,KAAR,CAAcJ,MAAd;AACA,WAAO,IAAP;AACH;;AAED,MAAGO,WAAH,EAAgB;AACZM,IAAAA,IAAI,CAACO,QAAL,GAAgB,EAAhB;;AACA,SAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGd,WAAW,CAACe,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxCR,MAAAA,IAAI,CAACO,QAAL,CAAcb,WAAW,CAACc,CAAD,CAAzB,IAAgCzE,EAAE,CAAC2E,kBAAH,CAAsBV,IAAtB,EAA4BN,WAAW,CAACc,CAAD,CAAvC,CAAhC;AACH;AACJ;;AAED,MAAGb,QAAH,EAAa;AACTK,IAAAA,IAAI,CAACW,UAAL,GAAkB,EAAlB;;AACA,SAAI,IAAIH,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGb,QAAQ,CAACc,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,UAAII,IAAI,GAAGjB,QAAQ,CAACa,CAAD,CAAnB;AACAR,MAAAA,IAAI,CAACW,UAAL,CAAgBC,IAAhB,IAAwB7E,EAAE,CAAC8E,iBAAH,CAAqBb,IAArB,EAA2BY,IAA3B,CAAxB;AACH;AACJ;;AAED,SAAOZ,IAAP;AACH;;AAED,SAASc,SAAT,CAAmBd,IAAnB,EAAyB;AACrBjE,EAAAA,EAAE,CAACgF,UAAH,CAAcf,IAAd;;AACA,OAAI,IAAIY,IAAR,IAAgBZ,IAAI,CAACW,UAArB,EAAiC;AAC7B5E,IAAAA,EAAE,CAACiF,uBAAH,CAA2BhB,IAAI,CAACW,UAAL,CAAgBC,IAAhB,CAA3B;AAAkD;AACrD;AACJ;;AAED,SAASK,WAAT,CAAqBjB,IAArB,EAA2B;AACvB,OAAI,IAAIY,IAAR,IAAgBZ,IAAI,CAACW,UAArB,EAAiC;AAC7B5E,IAAAA,EAAE,CAACmF,wBAAH,CAA4BlB,IAAI,CAACW,UAAL,CAAgBC,IAAhB,CAA5B;AAAmD;AACtD;;AACD7E,EAAAA,EAAE,CAACgF,UAAH,CAAc,IAAd;AACH,EAED;;;AACA,IAAII,UAAU,GAAG;AACb,WAAQ,EADK;AAEb,aAAU,IAAIxG,YAAJ,CAAiB,CAAC,GAAD,EAAM,KAAN,CAAjB,CAFG;AAGb,YAAShB,QAAQ,CAACiB,cAAT;AAHI,CAAjB;AAKA,IAAIwG,MAAM,GAAG;AACT,cAAW1H,OAAO,CAACE,MAAR,CAAe,CAAf,EAAkB,CAAlB,EAAqB,GAArB,CADF;AAET,YAASF,OAAO,CAACE,MAAR,CAAe,CAAf,EAAkB,CAAlB,EAAqB,CAArB,CAFA;AAGT,QAAKF,OAAO,CAACE,MAAR,CAAe,CAAf,EAAkB,CAAlB,EAAqB,CAArB,CAHI;AAIT,SAAMF,OAAO,CAACE,MAAR,CAAe,IAAf,EAAqB,GAArB,EAA0B,GAA1B,CAJG;AAKT,YAASD,QAAQ,CAACiB,cAAT;AALA,CAAb;AAQA,IAAIyG,WAAW,GAAG,EAAlB;AACA,IAAIC,UAAU,GAAG,EAAjB;AACA,IAAIC,YAAY,GAAG,KAAnB;;AAEA,IAAIC,eAAe,GAAG,SAAlBA,eAAkB,GAAY;AAC9B,OAAKC,QAAL,GAAgB,IAAIC,KAAJ,CAAU,CAAV,CAAhB;AACA,OAAKC,QAAL,GAAgB,IAAID,KAAJ,CAAU,CAAV,CAAhB;AACA,OAAKE,QAAL,GAAgB,IAAIF,KAAJ,CAAU,CAAV,CAAhB;AACA,OAAKG,KAAL,GAAa,IAAIH,KAAJ,CAAU,CAAV,CAAb;AACA,OAAKI,IAAL,GAAY,GAAZ;AACA,OAAKC,KAAL,GAAa,GAAb;AACA,OAAKC,IAAL,GAAY,GAAZ;AACH,CARD;;AAUAR,eAAe,CAACS,SAAhB,CAA0BC,WAA1B,GAAwC,UAAUC,EAAV,EAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AAC1D,OAAKZ,QAAL,CAAc,CAAd,IAAmBU,EAAnB;AACA,OAAKV,QAAL,CAAc,CAAd,IAAmBW,EAAnB;AACA,OAAKX,QAAL,CAAc,CAAd,IAAmBY,EAAnB;AACH,CAJD;;AAMAb,eAAe,CAACS,SAAhB,CAA0BK,WAA1B,GAAwC,UAAUC,EAAV,EAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AAC1D,OAAKd,QAAL,CAAc,CAAd,IAAmBY,EAAnB;AACA,OAAKZ,QAAL,CAAc,CAAd,IAAmBa,EAAnB;AACA,OAAKb,QAAL,CAAc,CAAd,IAAmBc,EAAnB;AACH,CAJD;;AAMAjB,eAAe,CAACS,SAAhB,CAA0BS,WAA1B,GAAwC,UAAUC,EAAV,EAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AAC1D,OAAKjB,QAAL,CAAc,CAAd,IAAmBe,EAAnB;AACA,OAAKf,QAAL,CAAc,CAAd,IAAmBgB,EAAnB;AACA,OAAKhB,QAAL,CAAc,CAAd,IAAmBiB,EAAnB;AACH,CAJD;;AAMArB,eAAe,CAACS,SAAhB,CAA0Ba,cAA1B,GAA2C,UAAUP,EAAV,EAAcC,EAAd,EAAkBC,EAAlB,EAAsB;AAC7D,OAAKZ,KAAL,CAAW,CAAX,IAAgBU,EAAhB;AACA,OAAKV,KAAL,CAAW,CAAX,IAAgBW,EAAhB;AACA,OAAKX,KAAL,CAAW,CAAX,IAAgBY,EAAhB;AACH,CAJD;;AAMAjB,eAAe,CAACS,SAAhB,CAA0BhG,OAA1B,GAAoC,UAAU8G,CAAV,EAAa;AAC7C,OAAKjB,IAAL,GAAYiB,CAAZ;AACH,CAFD;;AAIAvB,eAAe,CAACS,SAAhB,CAA0Be,MAA1B,GAAmC,UAAUC,EAAV,EAAcC,EAAd,EAAkB;AACjD,OAAKtB,QAAL,CAAc,CAAd,KAAoB,KAAKH,QAAL,CAAc,CAAd,IAAmBwB,EAAvC;AACA,OAAKrB,QAAL,CAAc,CAAd,KAAoB,KAAKH,QAAL,CAAc,CAAd,IAAmBwB,EAAvC;AACA,OAAKrB,QAAL,CAAc,CAAd,KAAoB,KAAKH,QAAL,CAAc,CAAd,IAAmBwB,EAAvC;AAEA,OAAKpB,KAAL,CAAW,CAAX,KAAiB,KAAKF,QAAL,CAAc,CAAd,IAAmBsB,EAApC;AACA,OAAKpB,KAAL,CAAW,CAAX,KAAiB,KAAKF,QAAL,CAAc,CAAd,IAAmBsB,EAApC;AACA,OAAKpB,KAAL,CAAW,CAAX,KAAiB,KAAKF,QAAL,CAAc,CAAd,IAAmBsB,EAApC;AACH,CARD;;AAUA,SAASE,kBAAT,GAA8B;AAC1B;AACA,MAAIC,GAAG,GAAGrH,EAAE,CAACsH,YAAH,CAAgBtH,EAAE,CAACuH,wBAAnB,CAAV;AACAtH,EAAAA,UAAU,CAACuH,SAAX,GAAuB;AAAC,WAAMH,GAAG,CAAC,CAAD,CAAV;AAAe,WAAMA,GAAG,CAAC,CAAD;AAAxB,GAAvB;AAEA,MAAI5D,MAAM,GAAGgE,QAAQ,CAACC,cAAT,CAAwB,kBAAxB,EAA4CC,WAAzD;AACA,MAAIjE,MAAM,GAAG+D,QAAQ,CAACC,cAAT,CAAwB,kBAAxB,EAA4CC,WAAzD;AAEArC,EAAAA,WAAW,CAACsC,OAAZ,GAAsB5E,YAAY,CAC9BS,MAD8B,EACtBC,MADsB,EAE9B,CAAC,aAAD,EAAgB,YAAhB,EAA8B,aAA9B,EAA6C,SAA7C,EAAwD,MAAxD,EAAgE,OAAhE,CAF8B,EAG9B,CAAC,WAAD,EAAc,QAAd,EAAwB,OAAxB,CAH8B,CAAlC;AAMAqB,EAAAA,SAAS,CAACO,WAAW,CAACsC,OAAb,CAAT;AACAtC,EAAAA,WAAW,CAACuC,MAAZ,GAAqB,IAAIjJ,YAAJ,CAAiB,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,CAAjB,CAArB;AACA0G,EAAAA,WAAW,CAACwC,KAAZ,GAAoBnK,OAAO,CAACE,MAAR,CAAe,GAAf,EAAoB,IAApB,EAA0B,GAA1B,CAApB,CAhB0B,CAkB1B;;AACAyH,EAAAA,WAAW,CAACyC,UAAZ,GAAyB,IAAzB;AACAzC,EAAAA,WAAW,CAAC0C,SAAZ,GAAwB,IAAIrC,KAAJ,CAAUL,WAAW,CAACyC,UAAtB,CAAxB,CApB0B,CAqB1B;;AACAzC,EAAAA,WAAW,CAAC2C,SAAZ,GAAwB,IAAIrJ,YAAJ,CAAiB0G,WAAW,CAACyC,UAAZ,IAA0B,IAAI,CAAJ,GAAQ,CAAlC,CAAjB,CAAxB;AACAzC,EAAAA,WAAW,CAAC4C,mBAAZ,GAAkC,CAAlC;AACA5C,EAAAA,WAAW,CAAC6C,gBAAZ,GAA+B7C,WAAW,CAACyC,UAAZ,GAAyB,CAAxD;AACAzC,EAAAA,WAAW,CAAC8C,eAAZ,GAA8B9C,WAAW,CAACyC,UAAZ,GAAyB,CAAvD;AAEAzC,EAAAA,WAAW,CAAC+C,MAAZ,GAAqBrI,EAAE,CAACsI,YAAH,EAArB;AACAtI,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+BlD,WAAW,CAAC+C,MAA3C;AACArI,EAAAA,EAAE,CAACyI,UAAH,CAAczI,EAAE,CAACwI,YAAjB,EAA+BlD,WAAW,CAAC2C,SAA3C,EAAsDjI,EAAE,CAAC0I,YAAzD;AACA1I,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+B,IAA/B;AAEAtD,EAAAA,WAAW,CAACI,WAAW,CAACsC,OAAb,CAAX;;AAEA,OAAI,IAAInD,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGa,WAAW,CAACyC,UAA/B,EAA2CtD,CAAC,EAA5C,EAAgD;AAC5Ca,IAAAA,WAAW,CAAC0C,SAAZ,CAAsBvD,CAAtB,IAA2B,IAAIgB,eAAJ,EAA3B;AACH;AACJ;;AAED,SAASkD,gBAAT,GAA4B;AACxB;AACArD,EAAAA,WAAW,CAACsD,IAAZ,GAAmBjL,OAAO,CAACE,MAAR,CAAe,IAAf,EAAqB,IAArB,EAA2B,IAA3B,CAAnB;AACAyH,EAAAA,WAAW,CAACsD,IAAZ,CAAiB9K,CAAjB,GAAqBwH,WAAW,CAACsD,IAAZ,CAAiB7K,CAAjB,GAAqBkC,UAAU,CAACjB,MAArD;AAEAsG,EAAAA,WAAW,CAACwC,KAAZ,CAAkBhK,CAAlB,GAAsB,IAAtB,CALwB,CAKI;;AAC5BwH,EAAAA,WAAW,CAACwC,KAAZ,CAAkB/J,CAAlB,GAAsBuH,WAAW,CAACsD,IAAZ,CAAiB5K,CAAvC,CANwB,CAMkB;;AAC1CsH,EAAAA,WAAW,CAACwC,KAAZ,CAAkB9J,CAAlB,GAAsB,GAAtB,CAPwB,CAOI;AAE5B;;AACA,MAAI6K,GAAG,GAAGrK,IAAI,CAACc,EAAL,GAAU,GAApB;AACA,MAAIwJ,KAAK,GAAGnL,OAAO,CAACE,MAAR,CAAe,CAAf,EAAkB,CAAlB,EAAqB,CAArB,CAAZ;AACA,MAAIkL,IAAI,GAAG,CAAX;;AACA,MAAIC,YAAY,GAAG,SAAfA,YAAe,GAAW;AAAC,WAAQxK,IAAI,CAACyK,MAAL,KAAgB,GAAhB,GAAsB,GAA9B;AAAoC,GAAnE;;AACA,OAAI,IAAIxE,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGa,WAAW,CAACyC,UAA/B,EAA2CtD,CAAC,EAA5C,EAAgD;AAC5C,QAAIyE,QAAQ,GAAG5D,WAAW,CAAC0C,SAAZ,CAAsBvD,CAAtB,CAAf,CAD4C,CAG5C;;AACAqE,IAAAA,KAAK,CAAChL,CAAN,GAAUkL,YAAY,KAAK,GAAjB,GAAuB,GAAjC;AACAF,IAAAA,KAAK,CAAC/K,CAAN,GAAUiL,YAAY,KAAK,GAAjB,GAAuB,GAAjC;AACAF,IAAAA,KAAK,CAAC9K,CAAN,GAAUgL,YAAY,KAAK,GAAjB,GAAuB,GAAjC;AACArL,IAAAA,OAAO,CAACW,SAAR,CAAkBwK,KAAlB;AACAC,IAAAA,IAAI,GAAG,MAAMvK,IAAI,CAACyK,MAAL,KAAgB,GAA7B;AACAC,IAAAA,QAAQ,CAAC/C,WAAT,CAAqB2C,KAAK,CAAChL,CAAN,GAAUiL,IAA/B,EAAqCD,KAAK,CAAC/K,CAAN,GAAUgL,IAA/C,EAAqDD,KAAK,CAAC9K,CAAN,GAAU+K,IAA/D,EAT4C,CAW5C;;AACAG,IAAAA,QAAQ,CAAC3C,WAAT,CACIyC,YAAY,KAAKH,GAAjB,GAAuB,GAD3B,EAEIG,YAAY,KAAKH,GAAjB,GAAuB,GAF3B,EAGIG,YAAY,KAAKH,GAAjB,GAAuB,GAH3B,EAZ4C,CAkB5C;;AACAK,IAAAA,QAAQ,CAACvC,WAAT,CACIqC,YAAY,KAAK1D,WAAW,CAACsD,IAAZ,CAAiB9K,CADtC,EAEIkL,YAAY,KAAK1D,WAAW,CAACsD,IAAZ,CAAiB7K,CAFtC,EAGIiL,YAAY,KAAK1D,WAAW,CAACsD,IAAZ,CAAiB5K,CAHtC,EAnB4C,CAyB5C;;AACAkL,IAAAA,QAAQ,CAACnC,cAAT,CACIvI,IAAI,CAACyK,MAAL,KAAgBzK,IAAI,CAACc,EAArB,GAA0B,GAD9B,EAEId,IAAI,CAACyK,MAAL,KAAgBzK,IAAI,CAACc,EAArB,GAA0B,GAF9B,EAGId,IAAI,CAACyK,MAAL,KAAgBzK,IAAI,CAACc,EAArB,GAA0B,GAH9B,EA1B4C,CAgC5C;;AACA4J,IAAAA,QAAQ,CAAChJ,OAAT,CAAiB,MAAM1B,IAAI,CAACyK,MAAL,KAAgB,GAAvC;AACH;AACJ;;AAED,SAASE,kBAAT,GAA8B;AAC1B;AACA,MAAIN,GAAG,GAAGrK,IAAI,CAACc,EAAL,GAAU,GAApB;AACA,MAAI8J,KAAK,GAAG,CAAC9D,WAAW,CAACsD,IAAZ,CAAiB9K,CAAlB,EAAqBwH,WAAW,CAACsD,IAAZ,CAAiB7K,CAAtC,EAAyCuH,WAAW,CAACsD,IAAZ,CAAiB5K,CAA1D,CAAZ;;AACA,MAAIqL,SAAS,GAAG,SAAZA,SAAY,CAAUC,GAAV,EAAeC,GAAf,EAAoBH,KAApB,EAA2B;AACvC,QAAG5K,IAAI,CAACgL,GAAL,CAASF,GAAG,CAACzD,QAAJ,CAAa0D,GAAb,CAAT,IAA8BD,GAAG,CAACvD,IAAJ,GAAW,GAAzC,GAA+CqD,KAAlD,EAAyD;AACrD;AACA,UAAGE,GAAG,CAACzD,QAAJ,CAAa0D,GAAb,IAAoB,CAAvB,EAA0B;AACtBD,QAAAA,GAAG,CAACzD,QAAJ,CAAa0D,GAAb,KAAqBH,KAAK,GAAG,GAA7B;AACH,OAFD,MAGK;AACDE,QAAAA,GAAG,CAACzD,QAAJ,CAAa0D,GAAb,KAAqBH,KAAK,GAAG,GAA7B;AACH;AACJ;AACJ,GAVD;;AAWA,MAAIK,WAAW,GAAG,SAAdA,WAAc,CAAUH,GAAV,EAAeC,GAAf,EAAoB;AAClCD,IAAAA,GAAG,CAACxD,KAAJ,CAAUyD,GAAV,IAAiBD,GAAG,CAACxD,KAAJ,CAAUyD,GAAV,IAAiBV,GAAlC;;AACA,QAAGS,GAAG,CAACxD,KAAJ,CAAUyD,GAAV,IAAiB,GAApB,EAAyB;AACrBD,MAAAA,GAAG,CAACxD,KAAJ,CAAUyD,GAAV,KAAkBV,GAAlB;AACH;AACJ,GALD;;AAOA,OAAI,IAAIpE,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGa,WAAW,CAACyC,UAA/B,EAA2CtD,CAAC,EAA5C,EAAgD;AAC5C,QAAIiF,KAAK,GAAGpE,WAAW,CAAC0C,SAAZ,CAAsBvD,CAAtB,CAAZ;AACAiF,IAAAA,KAAK,CAACzC,MAAN,CAAalH,QAAQ,CAAC4J,KAAtB,EAA6B5J,QAAQ,CAAC6J,OAAtC;AACAP,IAAAA,SAAS,CAACK,KAAD,EAAQ,CAAR,EAAWpE,WAAW,CAACsD,IAAZ,CAAiB9K,CAA5B,CAAT;AACAuL,IAAAA,SAAS,CAACK,KAAD,EAAQ,CAAR,EAAWpE,WAAW,CAACsD,IAAZ,CAAiB7K,CAA5B,CAAT;AACAsL,IAAAA,SAAS,CAACK,KAAD,EAAQ,CAAR,EAAWpE,WAAW,CAACsD,IAAZ,CAAiB5K,CAA5B,CAAT;AACAyL,IAAAA,WAAW,CAACC,KAAD,EAAQ,CAAR,CAAX;AACAD,IAAAA,WAAW,CAACC,KAAD,EAAQ,CAAR,CAAX;AACAD,IAAAA,WAAW,CAACC,KAAD,EAAQ,CAAR,CAAX;AAEAA,IAAAA,KAAK,CAAC1D,KAAN,GAAc,GAAd,CAV4C,CAU1B;;AAElB0D,IAAAA,KAAK,CAACzD,IAAN,GAAcZ,MAAM,CAACwE,MAAP,CAAc,CAAd,IAAmBH,KAAK,CAAC7D,QAAN,CAAe,CAAf,CAAnB,GACAR,MAAM,CAACwE,MAAP,CAAc,CAAd,IAAmBH,KAAK,CAAC7D,QAAN,CAAe,CAAf,CADnB,GAEAR,MAAM,CAACwE,MAAP,CAAc,EAAd,IAAoBH,KAAK,CAAC7D,QAAN,CAAe,CAAf,CAFpB,GAGAR,MAAM,CAACwE,MAAP,CAAc,EAAd,CAHd;AAIH,GAtCyB,CAwC1B;;;AACAvE,EAAAA,WAAW,CAAC0C,SAAZ,CAAsB8B,IAAtB,CAA2B,UAASC,EAAT,EAAaC,EAAb,EAAgB;AAAC,WAAOD,EAAE,CAAC9D,IAAH,GAAU+D,EAAE,CAAC/D,IAApB;AAA0B,GAAtE,EAzC0B,CA2C1B;;AACA,MAAIgE,IAAI,GAAG3E,WAAW,CAAC4C,mBAAvB;AACA,MAAIgC,MAAM,GAAG5E,WAAW,CAAC6C,gBAAzB;AACA,MAAIgC,KAAK,GAAG7E,WAAW,CAAC8C,eAAxB;;AACA,OAAI,IAAI3D,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGa,WAAW,CAACyC,UAA/B,EAA2CtD,CAAC,EAA5C,EAAgD;AAC5C,QAAIiF,KAAK,GAAGpE,WAAW,CAAC0C,SAAZ,CAAsBvD,CAAtB,CAAZ;AACAa,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBgC,IAAtB,IAA8BP,KAAK,CAAC7D,QAAN,CAAe,CAAf,CAA9B;AACAP,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBgC,IAAI,GAAG,CAA7B,IAAkCP,KAAK,CAAC7D,QAAN,CAAe,CAAf,CAAlC;AACAP,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBgC,IAAI,GAAG,CAA7B,IAAkCP,KAAK,CAAC7D,QAAN,CAAe,CAAf,CAAlC;AACAoE,IAAAA,IAAI,IAAI,CAAR;AACA3E,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBiC,MAAtB,IAAgCR,KAAK,CAAC5D,KAAN,CAAY,CAAZ,CAAhC;AACAR,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBiC,MAAM,GAAG,CAA/B,IAAoCR,KAAK,CAAC5D,KAAN,CAAY,CAAZ,CAApC;AACAR,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBiC,MAAM,GAAG,CAA/B,IAAoCR,KAAK,CAAC5D,KAAN,CAAY,CAAZ,CAApC;AACAoE,IAAAA,MAAM,IAAI,CAAV;AACA5E,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBkC,KAAtB,IAA+BT,KAAK,CAAC3D,IAArC;AACAT,IAAAA,WAAW,CAAC2C,SAAZ,CAAsBkC,KAAK,GAAG,CAA9B,IAAmCT,KAAK,CAAC1D,KAAzC;AACAmE,IAAAA,KAAK,IAAI,CAAT;AACH,GA5DyB,CA8D1B;;;AACAnK,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAACqK,KAAb,EA/D0B,CAgE1B;;AACArK,EAAAA,EAAE,CAACsK,SAAH,CAAatK,EAAE,CAACuK,SAAhB,EAA2BvK,EAAE,CAACwK,mBAA9B;AAEA,MAAIvG,IAAI,GAAGqB,WAAW,CAACsC,OAAvB;AACA7C,EAAAA,SAAS,CAACd,IAAD,CAAT;AAEAjE,EAAAA,EAAE,CAACyK,gBAAH,CAAoBxG,IAAI,CAACO,QAAL,CAAckG,WAAlC,EAA+C,KAA/C,EAAsDtF,UAAU,CAACyE,MAAjE;AACA7J,EAAAA,EAAE,CAACyK,gBAAH,CAAoBxG,IAAI,CAACO,QAAL,CAAcmG,UAAlC,EAA8C,KAA9C,EAAqDtF,MAAM,CAACwE,MAA5D;AACA7J,EAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcqG,WAA5B,EAAyC5K,UAAU,CAACtB,KAApD;AACAqB,EAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcsG,IAA5B,EAAkCnN,OAAO,CAACe,SAAR,CAAkB2G,MAAM,CAAC0F,GAAzB,CAAlC;AACA/K,EAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcwG,KAA5B,EAAmCrN,OAAO,CAACe,SAAR,CAAkB4G,WAAW,CAACwC,KAA9B,CAAnC;AAEA9H,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+BlD,WAAW,CAAC+C,MAA3C;AACArI,EAAAA,EAAE,CAACyI,UAAH,CAAczI,EAAE,CAACwI,YAAjB,EAA+BlD,WAAW,CAAC2C,SAA3C,EAAsDjI,EAAE,CAAC0I,YAAzD;AAEA1I,EAAAA,EAAE,CAACiL,mBAAH,CAAuBhH,IAAI,CAACW,UAAL,CAAgBsG,SAAvC,EAAkD,CAAlD,EAAqDlL,EAAE,CAACmL,KAAxD,EAA+D,KAA/D,EAAsE,CAAtE,EAAyE7F,WAAW,CAAC4C,mBAAZ,GAAkCtJ,YAAY,CAACwM,iBAAxH;AACApL,EAAAA,EAAE,CAACiL,mBAAH,CAAuBhH,IAAI,CAACW,UAAL,CAAgByG,MAAvC,EAA+C,CAA/C,EAAkDrL,EAAE,CAACmL,KAArD,EAA4D,KAA5D,EAAmE,CAAnE,EAAsE7F,WAAW,CAAC6C,gBAAZ,GAA+BvJ,YAAY,CAACwM,iBAAlH;AACApL,EAAAA,EAAE,CAACiL,mBAAH,CAAuBhH,IAAI,CAACW,UAAL,CAAgB0G,KAAvC,EAA8C,CAA9C,EAAiDtL,EAAE,CAACmL,KAApD,EAA2D,KAA3D,EAAkE,CAAlE,EAAqE7F,WAAW,CAAC8C,eAAZ,GAA8BxJ,YAAY,CAACwM,iBAAhH,EAjF0B,CAmF1B;;AACA,OAAI,IAAI3G,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,CAAnB,EAAsBA,CAAC,EAAvB,EAA2B;AACvB,QAAI8G,IAAI,GAAG9G,CAAC,GAAG,CAAC,GAAhB;AACAa,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB9K,CAAjB,GAAqB,CAAC,GAA9C;AACAwH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB7K,CAAjB,GAAqB,CAAC,GAA9C;AACAuH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB5K,CAAjB,GAAqBuN,IAA7C;AACAvL,IAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcgH,OAA5B,EAAqClG,WAAW,CAACuC,MAAjD;AACA7H,IAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC0L,KAAjB,EAAwB,CAAxB,EAA2BpG,WAAW,CAACyC,UAAvC;AAEAzC,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB9K,CAAjB,GAAqB,CAAC,GAA9C;AACAwH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB7K,CAAjB,GAAsB,GAA9C;AACAuH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB5K,CAAjB,GAAqBuN,IAA7C;AACAvL,IAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcgH,OAA5B,EAAqClG,WAAW,CAACuC,MAAjD;AACA7H,IAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC0L,KAAjB,EAAwB,CAAxB,EAA2BpG,WAAW,CAACyC,UAAvC;AAEAzC,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB9K,CAAjB,GAAsB,GAA9C;AACAwH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB7K,CAAjB,GAAqB,CAAC,GAA9C;AACAuH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB5K,CAAjB,GAAqBuN,IAA7C;AACAvL,IAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcgH,OAA5B,EAAqClG,WAAW,CAACuC,MAAjD;AACA7H,IAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC0L,KAAjB,EAAwB,CAAxB,EAA2BpG,WAAW,CAACyC,UAAvC;AAEAzC,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB9K,CAAjB,GAAsB,GAA9C;AACAwH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB7K,CAAjB,GAAsB,GAA9C;AACAuH,IAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwBvC,WAAW,CAACsD,IAAZ,CAAiB5K,CAAjB,GAAqBuN,IAA7C;AACAvL,IAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcgH,OAA5B,EAAqClG,WAAW,CAACuC,MAAjD;AACA7H,IAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC0L,KAAjB,EAAwB,CAAxB,EAA2BpG,WAAW,CAACyC,UAAvC;AACH,GA7GyB,CA+G1B;;;AACAzC,EAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwB,GAAxB;AACAvC,EAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwB,GAAxB;AACAvC,EAAAA,WAAW,CAACuC,MAAZ,CAAmB,CAAnB,IAAwB,GAAxB;AACA7H,EAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcgH,OAA5B,EAAqClG,WAAW,CAACuC,MAAjD;AACA7H,EAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC0L,KAAjB,EAAwB,CAAxB,EAA2BpG,WAAW,CAACyC,UAAvC;AAEA/H,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+B,IAA/B;AACAtD,EAAAA,WAAW,CAACjB,IAAD,CAAX;AAEAjE,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAAC2L,UAAb;AACA3L,EAAAA,EAAE,CAAC4L,OAAH,CAAW5L,EAAE,CAACqK,KAAd;AACH,EAED;AACA;;;AACA,SAASwB,mBAAT,CAA6BpI,MAA7B,EAAqCC,MAArC,EAA6CoI,OAA7C,EAAsDC,OAAtD,EAA+D;AAC3D,MAAI7K,GAAG,GAAG,EAAV;AACA,MAAI8K,KAAK,GAAG,CAAC,aAAD,EAAgB,MAAhB,EAAwB,QAAxB,CAAZ;;AACA,MAAGF,OAAH,EAAY;AACRE,IAAAA,KAAK,GAAGA,KAAK,CAACC,MAAN,CAAaH,OAAb,CAAR;AACH;;AACD,MAAII,KAAK,GAAG,CAAC,WAAD,CAAZ;;AACA,MAAGH,OAAH,EAAY;AACRG,IAAAA,KAAK,GAAGA,KAAK,CAACD,MAAN,CAAaF,OAAb,CAAR;AACH;;AAED7K,EAAAA,GAAG,CAAC0G,OAAJ,GAAc5E,YAAY,CAACS,MAAD,EAASC,MAAT,EAAiBsI,KAAjB,EAAwBE,KAAxB,CAA1B;AACAnH,EAAAA,SAAS,CAAC7D,GAAG,CAAC0G,OAAL,CAAT;AAEA1G,EAAAA,GAAG,CAAC+G,SAAJ,GAAgB,IAAIrJ,YAAJ,CAAiB,CAC7B,CAAC,GAD4B,EACvB,CAAC,GADsB,EAE5B,GAF4B,EAEvB,CAAC,GAFsB,EAG7B,CAAC,GAH4B,EAGtB,GAHsB,EAI5B,GAJ4B,EAItB,GAJsB,CAAjB,CAAhB;AAMAsC,EAAAA,GAAG,CAACmH,MAAJ,GAAarI,EAAE,CAACsI,YAAH,EAAb;AACAtI,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+BtH,GAAG,CAACmH,MAAnC;AACArI,EAAAA,EAAE,CAACyI,UAAH,CAAczI,EAAE,CAACwI,YAAjB,EAA+BtH,GAAG,CAAC+G,SAAnC,EAA8CjI,EAAE,CAACmM,WAAjD;AAEAnM,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+B,IAA/B;AACAtD,EAAAA,WAAW,CAAChE,GAAG,CAAC0G,OAAL,CAAX;AAEA,SAAO1G,GAAP;AACH,EAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASkL,SAAT,CAAmBC,KAAnB,EAA0BC,MAA1B,EAAkC;AAC9B,MAAIrI,IAAI,GAAGoI,KAAK,CAACzE,OAAjB;AACA7C,EAAAA,SAAS,CAACd,IAAD,CAAT;AACAjE,EAAAA,EAAE,CAAC4K,UAAH,CAAc3G,IAAI,CAACO,QAAL,CAAcqG,WAA5B,EAAyC5K,UAAU,CAACtB,KAApD;;AAEA,MAAG2N,MAAM,IAAI,IAAb,EAAmB;AACftM,IAAAA,EAAE,CAACuM,UAAH,CAActI,IAAI,CAACO,QAAL,CAAcgI,MAA5B,EAAoCF,MAAM,CAACG,QAA3C;AACAzM,IAAAA,EAAE,CAAC0M,SAAH,CAAazI,IAAI,CAACO,QAAL,CAAcmI,IAA3B,EAAiC,CAAjC;AAEA3M,IAAAA,EAAE,CAAC4M,aAAH,CAAiB5M,EAAE,CAAC6M,QAApB;AACA7M,IAAAA,EAAE,CAACsB,WAAH,CAAetB,EAAE,CAACuB,UAAlB,EAA8B+K,MAAM,CAACtL,OAArC;AACH;AACJ;;AACD,SAAS8L,UAAT,CAAoBT,KAApB,EAA2B;AACvBrM,EAAAA,EAAE,CAACuI,UAAH,CAAcvI,EAAE,CAACwI,YAAjB,EAA+B6D,KAAK,CAAChE,MAArC;AACArI,EAAAA,EAAE,CAACiL,mBAAH,CAAuBoB,KAAK,CAACzE,OAAN,CAAchD,UAAd,CAAyBsG,SAAhD,EAA2D,CAA3D,EAA8DlL,EAAE,CAACmL,KAAjE,EAAwE,KAAxE,EAA+E,CAA/E,EAAkF,CAAlF;AACAnL,EAAAA,EAAE,CAACyL,UAAH,CAAczL,EAAE,CAAC+M,cAAjB,EAAiC,CAAjC,EAAoC,CAApC;AACH;;AACD,SAASC,WAAT,CAAqBX,KAArB,EAA4B;AACxBnH,EAAAA,WAAW,CAACmH,KAAK,CAACzE,OAAP,CAAX;AACH;;AAED,IAAIqF,SAAS,GAAG,EAAhB;;AACA,SAASC,eAAT,GAA2B;AAEvB,MAAIzJ,MAAJ,EAAYC,MAAZ,CAFuB,CAGvB;;AACA,MAAIyJ,SAAS,GAAG1F,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCC,WAAzD,CAJuB,CAMvB;;AACAjE,EAAAA,MAAM,GAAG+D,QAAQ,CAACC,cAAT,CAAwB,QAAxB,EAAkCC,WAA3C;AACAsF,EAAAA,SAAS,CAACG,OAAV,GAAoBvB,mBAAmB,CAACsB,SAAD,EAAYzJ,MAAZ,EAAoB,CAAC,QAAD,CAApB,EAAgC,IAAhC,CAAvC,CARuB,CAUvB;;AACAA,EAAAA,MAAM,GAAG+D,QAAQ,CAACC,cAAT,CAAwB,kBAAxB,EAA4CC,WAArD;AACAsF,EAAAA,SAAS,CAACI,WAAV,GAAwBxB,mBAAmB,CAACsB,SAAD,EAAYzJ,MAAZ,EAAoB,IAApB,EAA0B,IAA1B,CAA3C,CAZuB,CAcvB;;AACAA,EAAAA,MAAM,GAAG+D,QAAQ,CAACC,cAAT,CAAwB,mBAAxB,EAA6CC,WAAtD;AACAsF,EAAAA,SAAS,CAACK,OAAV,GAAoBzB,mBAAmB,CAACsB,SAAD,EAAYzJ,MAAZ,EAAoB,CAAC,UAAD,CAApB,EAAkC,IAAlC,CAAvC,CAhBuB,CAkBvB;;AACAD,EAAAA,MAAM,GAAGgE,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,WAAjD;AACAjE,EAAAA,MAAM,GAAG+D,QAAQ,CAACC,cAAT,CAAwB,cAAxB,EAAwCC,WAAjD;AACAsF,EAAAA,SAAS,CAACM,SAAV,GAAsB1B,mBAAmB,CAACpI,MAAD,EAASC,MAAT,EAAiB,CAAC,QAAD,CAAjB,EAA6B,IAA7B,CAAzC;AACH,EAED;;;AACA,SAAS8J,gBAAT,GAA4B,CACxB;AACH;;AACD,SAASC,cAAT,GAA0B,CACtB;AACH;;AACD,SAASC,gBAAT,GAA4B;AACxB1N,EAAAA,EAAE,CAAC4L,OAAH,CAAW5L,EAAE,CAAC2L,UAAd;AAEAS,EAAAA,SAAS,CAACa,SAAS,CAACG,OAAX,EAAoB,IAApB,CAAT;AACApN,EAAAA,EAAE,CAAC2N,SAAH,CAAaV,SAAS,CAACG,OAAV,CAAkBxF,OAAlB,CAA0BpD,QAA1B,CAAmCoJ,MAAhD,EAAwD7N,QAAQ,CAAC6J,OAAjE,EAA0E7J,QAAQ,CAAC4J,KAAnF;AACAmD,EAAAA,UAAU,CAACG,SAAS,CAACG,OAAX,CAAV;AACAJ,EAAAA,WAAW,CAACC,SAAS,CAACG,OAAX,CAAX;AAEApN,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAAC2L,UAAb;AACH,EAED;;;AACA,IAAIkC,WAAW,GAAG,EAAlB;;AACA,SAASC,iBAAT,GAA6B,CACzB;AACH;;AACD,SAASC,eAAT,GAA2B,CACvB;AACH;;AAED,SAASC,iBAAT,GAA6B;AACzBhO,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAACuB,UAAb;AACAvB,EAAAA,EAAE,CAAC4L,OAAH,CAAW5L,EAAE,CAAC2L,UAAd;;AACA,MAAIsC,MAAM,GAAG,SAATA,MAAS,CAAUvN,EAAV,EAAcwN,OAAd,EAAuB;AAChClO,IAAAA,EAAE,CAACkC,eAAH,CAAmBlC,EAAE,CAACmC,WAAtB,EAAmCzB,EAAE,CAACE,WAAtC;AACAZ,IAAAA,EAAE,CAACmO,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBzN,EAAE,CAACP,KAArB,EAA4BO,EAAE,CAACN,MAA/B;;AACA,QAAG8N,OAAH,EAAY;AACRlO,MAAAA,EAAE,CAACoO,UAAH,CAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,EAAuB,CAAvB;AACApO,MAAAA,EAAE,CAACqO,KAAH,CAASrO,EAAE,CAACsO,gBAAH,GAAsBtO,EAAE,CAACuO,gBAAlC;AACH;AACJ,GAPD,CAHyB,CAYzB;;;AACAN,EAAAA,MAAM,CAAChO,UAAU,CAACuO,QAAZ,EAAsB,IAAtB,CAAN;AACApC,EAAAA,SAAS,CAACa,SAAS,CAACI,WAAX,EAAwBpN,UAAU,CAACwO,MAAnC,CAAT;AACA3B,EAAAA,UAAU,CAACG,SAAS,CAACI,WAAX,CAAV;AACAL,EAAAA,WAAW,CAACC,SAAS,CAACI,WAAX,CAAX,CAhByB,CAkBzB;;AACA,OAAI,IAAI5I,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,CAAnB,EAAsBA,CAAC,EAAvB,EAA2B;AACvB,QAAIiK,CAAC,GAAG,MAAM,IAAIjK,CAAlB;AACA,QAAIuC,CAAC,GAAG,MAAM,IAAIvC,CAAlB;AACAwJ,IAAAA,MAAM,CAAChO,UAAU,CAAC0O,QAAZ,EAAsB,IAAtB,CAAN;AACAvC,IAAAA,SAAS,CAACa,SAAS,CAACK,OAAX,EAAoBrN,UAAU,CAACuO,QAA/B,CAAT;AACAxO,IAAAA,EAAE,CAAC4O,SAAH,CAAa3B,SAAS,CAACK,OAAV,CAAkB1F,OAAlB,CAA0BpD,QAA1B,CAAmCqK,QAAhD,EAA0DH,CAA1D,EAA6D,GAA7D,EAAkE1H,CAAlE,EAAqE,GAArE;AACA8F,IAAAA,UAAU,CAACG,SAAS,CAACK,OAAX,CAAV;AACAN,IAAAA,WAAW,CAACC,SAAS,CAACK,OAAX,CAAX;AAEAW,IAAAA,MAAM,CAAChO,UAAU,CAACuO,QAAZ,EAAsB,IAAtB,CAAN;AACApC,IAAAA,SAAS,CAACa,SAAS,CAACK,OAAX,EAAoBrN,UAAU,CAAC0O,QAA/B,CAAT;AACA3O,IAAAA,EAAE,CAAC4O,SAAH,CAAa3B,SAAS,CAACK,OAAV,CAAkB1F,OAAlB,CAA0BpD,QAA1B,CAAmCqK,QAAhD,EAA0D,GAA1D,EAA+DH,CAA/D,EAAkE,GAAlE,EAAuE1H,CAAvE;AACA8F,IAAAA,UAAU,CAACG,SAAS,CAACK,OAAX,CAAV;AACAN,IAAAA,WAAW,CAACC,SAAS,CAACK,OAAX,CAAX;AACH,GAjCwB,CAmCzB;;;AACAtN,EAAAA,EAAE,CAACkC,eAAH,CAAmBlC,EAAE,CAACmC,WAAtB,EAAmC,IAAnC;AACAnC,EAAAA,EAAE,CAACmO,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBlO,UAAU,CAACE,KAA7B,EAAoCF,UAAU,CAACG,MAA/C;AACAJ,EAAAA,EAAE,CAACqO,KAAH,CAASrO,EAAE,CAACsO,gBAAH,GAAsBtO,EAAE,CAACuO,gBAAlC;AAEAnC,EAAAA,SAAS,CAACa,SAAS,CAACM,SAAX,EAAsBtN,UAAU,CAACwO,MAAjC,CAAT;AACAzO,EAAAA,EAAE,CAAC0M,SAAH,CAAaO,SAAS,CAACM,SAAV,CAAoB3F,OAApB,CAA4BpD,QAA5B,CAAqCsK,MAAlD,EAA0D,CAA1D;AACA9O,EAAAA,EAAE,CAAC4M,aAAH,CAAiB5M,EAAE,CAAC+O,QAApB;AACA/O,EAAAA,EAAE,CAACsB,WAAH,CAAetB,EAAE,CAACuB,UAAlB,EAA8BtB,UAAU,CAACuO,QAAX,CAAoBxN,OAAlD;AACA8L,EAAAA,UAAU,CAACG,SAAS,CAACM,SAAX,CAAV;AACAP,EAAAA,WAAW,CAACC,SAAS,CAACM,SAAX,CAAX;AAEAvN,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAAC2L,UAAb;AACH,EAED;;;AACA,IAAIqD,QAAQ,GAAG,EAAf;;AACA,SAASC,WAAT,GAAuB;AACnB/B,EAAAA,eAAe;AACfM,EAAAA,gBAAgB;AAChBpG,EAAAA,kBAAkB;AAClB0G,EAAAA,iBAAiB;AACjBtI,EAAAA,YAAY,GAAG,IAAf;AACH;;AAED,SAAS0J,SAAT,GAAqB;AACjBzB,EAAAA,cAAc;AACd9E,EAAAA,gBAAgB;AAChBoF,EAAAA,eAAe,GAHE,CAKjB;;AACA1I,EAAAA,MAAM,CAACQ,QAAP,CAAgB7H,CAAhB,GAAoBsH,WAAW,CAACsD,IAAZ,CAAiB5K,CAAjB,GAAqBoH,UAAU,CAAC+J,OAAX,CAAmB,CAAnB,CAAzC;AACA/J,EAAAA,UAAU,CAACgK,KAAX,GAAmB5Q,IAAI,CAAC6Q,KAAL,CAAW/J,WAAW,CAACsD,IAAZ,CAAiB7K,CAA5B,EAA+BsH,MAAM,CAACQ,QAAP,CAAgB7H,CAAhB,GAAoBsH,WAAW,CAACsD,IAAZ,CAAiB5K,CAApE,IAAyE,KAAzE,GAAiFQ,IAAI,CAACc,EAAtF,GAA2F,GAA9G;AACA1B,EAAAA,QAAQ,CAACkB,cAAT,CAAwBsG,UAAU,CAACyE,MAAnC,EAA2C5J,UAAU,CAACjB,MAAtD,EAA8DoG,UAAU,CAACgK,KAAzE,EAAgFhK,UAAU,CAAC+J,OAAX,CAAmB,CAAnB,CAAhF,EAAuG/J,UAAU,CAAC+J,OAAX,CAAmB,CAAnB,CAAvG;AACH;;AAED,SAASG,WAAT,GAAuB;AACnB;AACA1R,EAAAA,QAAQ,CAAC4B,UAAT,CAAoB6F,MAAM,CAACwE,MAA3B,EAAmCxE,MAAM,CAACQ,QAA1C,EAAoDR,MAAM,CAACkK,MAA3D,EAAmElK,MAAM,CAACmK,EAA1E;AAEAxP,EAAAA,EAAE,CAACoK,MAAH,CAAUpK,EAAE,CAAC2L,UAAb,EAJmB,CAMnB;;AACA3L,EAAAA,EAAE,CAACkC,eAAH,CAAmBlC,EAAE,CAACmC,WAAtB,EAAmClC,UAAU,CAACwO,MAAX,CAAkB7N,WAArD;AACAZ,EAAAA,EAAE,CAACmO,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBlO,UAAU,CAACwO,MAAX,CAAkBtO,KAApC,EAA2CF,UAAU,CAACwO,MAAX,CAAkBrO,MAA7D;AACAJ,EAAAA,EAAE,CAACoO,UAAH,CAAc,KAAd,EAAqB,CAArB,EAAwB,IAAxB,EAA8B,CAA9B;AACApO,EAAAA,EAAE,CAACqO,KAAH,CAASrO,EAAE,CAACsO,gBAAH,GAAsBtO,EAAE,CAACuO,gBAAlC;AAEAb,EAAAA,gBAAgB;AAChBvE,EAAAA,kBAAkB;AAClB6E,EAAAA,iBAAiB;AACpB,EAED;;;AACA,SAASyB,QAAT,CAAkBC,CAAlB,EAAqB;AACjBC,EAAAA,oBAAoB,CAAClI,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAD,CAApB;AACAkI,EAAAA,YAAY;;AACZ,MAAGpK,YAAH,EAAiB;AACb0J,IAAAA,SAAS;AACZ;AACJ;;AAED,SAASU,YAAT,GAAwB;AACpB3P,EAAAA,UAAU,CAACC,OAAX,CAAmBF,EAAE,CAAC6P,MAAH,CAAU1P,KAA7B,EAAoCH,EAAE,CAAC6P,MAAH,CAAUzP,MAA9C;AAEAJ,EAAAA,EAAE,CAACoO,UAAH,CAAc,GAAd,EAAmB,GAAnB,EAAwB,GAAxB,EAA6B,GAA7B;AACApO,EAAAA,EAAE,CAACmO,QAAH,CAAY,CAAZ,EAAe,CAAf,EAAkBlO,UAAU,CAACE,KAA7B,EAAoCF,UAAU,CAACG,MAA/C;;AAEA,MAAI0P,MAAM,GAAG,SAATA,MAAS,CAAUC,MAAV,EAAkBC,GAAlB,EAAuBC,GAAvB,EAA4B;AACrC,QAAIvP,EAAE,GAAGT,UAAU,CAAC8P,MAAD,CAAnB;AACA,QAAGrP,EAAH,EAAOD,kBAAkB,CAACC,EAAD,CAAlB;AACPT,IAAAA,UAAU,CAAC8P,MAAD,CAAV,GAAqB9O,kBAAkB,CAAC+O,GAAD,EAAMC,GAAN,CAAvC;AACH,GAJD;;AAKAH,EAAAA,MAAM,CAAC,QAAD,EAAW7P,UAAU,CAACE,KAAtB,EAA6BF,UAAU,CAACG,MAAxC,CAAN;AACA0P,EAAAA,MAAM,CAAC,UAAD,EAAa7P,UAAU,CAACE,KAAxB,EAA+BF,UAAU,CAACG,MAA1C,CAAN;AACA0P,EAAAA,MAAM,CAAC,UAAD,EAAa7P,UAAU,CAACE,KAAxB,EAA+BF,UAAU,CAACG,MAA1C,CAAN;AACA0P,EAAAA,MAAM,CAAC,UAAD,EAAa7P,UAAU,CAACI,SAAxB,EAAmCJ,UAAU,CAACM,UAA9C,CAAN;AACAuP,EAAAA,MAAM,CAAC,UAAD,EAAa7P,UAAU,CAACI,SAAxB,EAAmCJ,UAAU,CAACM,UAA9C,CAAN;AACH;;AAED,SAAS2P,MAAT,GAAkB;AACdZ,EAAAA,WAAW;AACd;;AAED,IAAIa,SAAS,GAAG,IAAhB;;AACA,SAASC,eAAT,CAAyBC,GAAzB,EAA8B;AAC1BF,EAAAA,SAAS,IAAI,IAAb;AACA,MAAGA,SAAH,EAAcG,OAAO;;AACrB,MAAGD,GAAH,EAAQ;AACJA,IAAAA,GAAG,CAACE,SAAJ,GAAgBJ,SAAS,GAAE,MAAF,GAAS,OAAlC;AACH;AACJ;;AAED,SAASK,aAAT,GAAyB;AACrB,MAAG,CAACL,SAAJ,EAAeG,OAAO;AACzB;;AAED,SAASA,OAAT,GAAmB;AACf,MAAIG,OAAO,GAAG,IAAIC,IAAJ,EAAd;AACA3Q,EAAAA,QAAQ,CAAC6J,OAAT,GAAmB,CAAC6G,OAAO,GAAG1Q,QAAQ,CAAC4Q,KAApB,IAA6B,MAAhD;AACA5Q,EAAAA,QAAQ,CAAC4J,KAAT,GAAiB,CAAC8G,OAAO,GAAG1Q,QAAQ,CAAC6Q,IAApB,IAA4B,MAA7C;AACA7Q,EAAAA,QAAQ,CAAC6Q,IAAT,GAAgBH,OAAhB;AAEA,MAAGN,SAAH,EAAcU,qBAAqB,CAACP,OAAD,CAArB;AACdJ,EAAAA,MAAM;AACT;;AAED,SAASP,oBAAT,CAA8BE,MAA9B,EAAsC;AAClC,MAAIiB,CAAC,GAAGrJ,QAAQ,CAACsJ,IAAjB;AACH,MAAIC,CAAC,GAAGvJ,QAAQ,CAACwJ,eAAjB;AACAC,EAAAA,KAAK,GAAG1S,IAAI,CAAC2S,GAAL,CAASL,CAAC,CAACM,WAAX,EAAyBN,CAAC,CAACO,WAA3B,EAAwCL,CAAC,CAACK,WAA1C,EAAuDL,CAAC,CAACI,WAAzD,CAAR;AACAE,EAAAA,KAAK,GAAG9S,IAAI,CAAC2S,GAAL,CAASL,CAAC,CAACS,YAAX,EAA0BT,CAAC,CAACU,YAA5B,EAA0CR,CAAC,CAACQ,YAA5C,EAA0DR,CAAC,CAACO,YAA5D,CAAR;AACA1B,EAAAA,MAAM,CAAC1P,KAAP,GAAe+Q,KAAf;AACArB,EAAAA,MAAM,CAACzP,MAAP,GAAgBkR,KAAhB;AACA;;AAEDG,MAAM,CAACC,gBAAP,CAAwB,MAAxB,EAAgC,UAAShC,CAAT,EAAY;AACxC,MAAIG,MAAM,GAAGpI,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAb;;AACA,MAAI;AACAiI,IAAAA,oBAAoB,CAACE,MAAD,CAApB;AACA7P,IAAAA,EAAE,GAAG6P,MAAM,CAAC8B,UAAP,CAAkB,oBAAlB,CAAL;AACH,GAHD,CAGE,OAAMjC,CAAN,EAAS;AACPkC,IAAAA,KAAK,CAAC,yBAAyBlC,CAA1B,CAAL;AACAnM,IAAAA,OAAO,CAACC,KAAR,CAAckM,CAAd;AACA;AACH;;AAED+B,EAAAA,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAkCjC,QAAlC;AAEAG,EAAAA,YAAY;AACZX,EAAAA,WAAW;AACXC,EAAAA,SAAS;AAETnP,EAAAA,QAAQ,CAAC4Q,KAAT,GAAiB,IAAID,IAAJ,EAAjB;AACA3Q,EAAAA,QAAQ,CAAC6Q,IAAT,GAAgB7Q,QAAQ,CAAC4Q,KAAzB;AACAL,EAAAA,OAAO;AACV,CApBD,GAsBA;;AACA,CAAC,UAAU/Q,CAAV,EAAasS,CAAb,EAAgB;AACbtS,EAAAA,CAAC,CAAC,MAAIsS,CAAL,CAAD,GAAWtS,CAAC,CAAC,MAAIsS,CAAL,CAAD,IAAYtS,CAAC,CAAC,YAAUsS,CAAX,CAAb,IAA8BtS,CAAC,CAAC,SAAOsS,CAAR,CAA/B,IAA6CtS,CAAC,CAAC,QAAMsS,CAAP,CAA9C,IAA2DtS,CAAC,CAAC,OAAKsS,CAAN,CAA5D,IAAwE,UAASC,CAAT,EAAW;AAAEvS,IAAAA,CAAC,CAACwS,UAAF,CAAaD,CAAb,EAAgB,OAAO,EAAvB;AAA6B,GAA7H;AACH,CAFD,EAEGL,MAFH,EAEW,sBAFX","file":"background.f4eb8f1d.map","sourceRoot":"..","sourcesContent":["// Utilities\nvar Vector3 = {};\nvar Matrix44 = {};\nVector3.create = function(x, y, z) {\n    return {'x':x, 'y':y, 'z':z};\n};\nVector3.dot = function (v0, v1) {\n    return v0.x * v1.x + v0.y * v1.y + v0.z * v1.z;\n};\nVector3.cross = function (v, v0, v1) {\n    v.x = v0.y * v1.z - v0.z * v1.y;\n    v.y = v0.z * v1.x - v0.x * v1.z;\n    v.z = v0.x * v1.y - v0.y * v1.x;\n};\nVector3.normalize = function (v) {\n    var l = v.x * v.x + v.y * v.y + v.z * v.z;\n    if(l > 0.00001) {\n        l = 1.0 / Math.sqrt(l);\n        v.x *= l;\n        v.y *= l;\n        v.z *= l;\n    }\n};\nVector3.arrayForm = function(v) {\n    if(v.array) {\n        v.array[0] = v.x;\n        v.array[1] = v.y;\n        v.array[2] = v.z;\n    }\n    else {\n        v.array = new Float32Array([v.x, v.y, v.z]);\n    }\n    return v.array;\n};\nMatrix44.createIdentity = function () {\n    return new Float32Array([1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]);\n};\nMatrix44.loadProjection = function (m, aspect, vdeg, near, far) {\n    var h = near * Math.tan(vdeg * Math.PI / 180.0 * 0.5) * 2.0;\n    var w = h * aspect;\n    \n    m[0] = 2.0 * near / w;\n    m[1] = 0.0;\n    m[2] = 0.0;\n    m[3] = 0.0;\n    \n    m[4] = 0.0;\n    m[5] = 2.0 * near / h;\n    m[6] = 0.0;\n    m[7] = 0.0;\n    \n    m[8] = 0.0;\n    m[9] = 0.0;\n    m[10] = -(far + near) / (far - near);\n    m[11] = -1.0;\n    \n    m[12] = 0.0;\n    m[13] = 0.0;\n    m[14] = -2.0 * far * near / (far - near);\n    m[15] = 0.0;\n};\nMatrix44.loadLookAt = function (m, vpos, vlook, vup) {\n    var frontv = Vector3.create(vpos.x - vlook.x, vpos.y - vlook.y, vpos.z - vlook.z);\n    Vector3.normalize(frontv);\n    var sidev = Vector3.create(1.0, 0.0, 0.0);\n    Vector3.cross(sidev, vup, frontv);\n    Vector3.normalize(sidev);\n    var topv = Vector3.create(1.0, 0.0, 0.0);\n    Vector3.cross(topv, frontv, sidev);\n    Vector3.normalize(topv);\n    \n    m[0] = sidev.x;\n    m[1] = topv.x;\n    m[2] = frontv.x;\n    m[3] = 0.0;\n    \n    m[4] = sidev.y;\n    m[5] = topv.y;\n    m[6] = frontv.y;\n    m[7] = 0.0;\n    \n    m[8] = sidev.z;\n    m[9] = topv.z;\n    m[10] = frontv.z;\n    m[11] = 0.0;\n    \n    m[12] = -(vpos.x * m[0] + vpos.y * m[4] + vpos.z * m[8]);\n    m[13] = -(vpos.x * m[1] + vpos.y * m[5] + vpos.z * m[9]);\n    m[14] = -(vpos.x * m[2] + vpos.y * m[6] + vpos.z * m[10]);\n    m[15] = 1.0;\n};\n\n//\nvar timeInfo = {\n    'start':0, 'prev':0, // Date\n    'delta':0, 'elapsed':0 // Number(sec)\n};\n\n//\nvar gl;\nvar renderSpec = {\n    'width':0,\n    'height':0,\n    'aspect':1,\n    'array':new Float32Array(3),\n    'halfWidth':0,\n    'halfHeight':0,\n    'halfArray':new Float32Array(3)\n    // and some render targets. see setViewport()\n};\nrenderSpec.setSize = function(w, h) {\n    renderSpec.width = w;\n    renderSpec.height = h;\n    renderSpec.aspect = renderSpec.width / renderSpec.height;\n    renderSpec.array[0] = renderSpec.width;\n    renderSpec.array[1] = renderSpec.height;\n    renderSpec.array[2] = renderSpec.aspect;\n    \n    renderSpec.halfWidth = Math.floor(w / 2);\n    renderSpec.halfHeight = Math.floor(h / 2);\n    renderSpec.halfArray[0] = renderSpec.halfWidth;\n    renderSpec.halfArray[1] = renderSpec.halfHeight;\n    renderSpec.halfArray[2] = renderSpec.halfWidth / renderSpec.halfHeight;\n};\n\nfunction deleteRenderTarget(rt) {\n    gl.deleteFramebuffer(rt.frameBuffer);\n    gl.deleteRenderbuffer(rt.renderBuffer);\n    gl.deleteTexture(rt.texture);\n}\n\nfunction createRenderTarget(w, h) {\n    var ret = {\n        'width':w,\n        'height':h,\n        'sizeArray':new Float32Array([w, h, w / h]),\n        'dtxArray':new Float32Array([1.0 / w, 1.0 / h])\n    };\n    ret.frameBuffer = gl.createFramebuffer();\n    ret.renderBuffer = gl.createRenderbuffer();\n    ret.texture = gl.createTexture();\n    \n    gl.bindTexture(gl.TEXTURE_2D, ret.texture);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, w, h, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    \n    gl.bindFramebuffer(gl.FRAMEBUFFER, ret.frameBuffer);\n    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, ret.texture, 0);\n    \n    gl.bindRenderbuffer(gl.RENDERBUFFER, ret.renderBuffer);\n    gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, w, h);\n    gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, ret.renderBuffer);\n    \n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    \n    return ret;\n}\n\nfunction compileShader(shtype, shsrc) {\n\tvar retsh = gl.createShader(shtype);\n\t\n\tgl.shaderSource(retsh, shsrc);\n\tgl.compileShader(retsh);\n\t\n\tif(!gl.getShaderParameter(retsh, gl.COMPILE_STATUS)) {\n\t\tvar errlog = gl.getShaderInfoLog(retsh);\n\t\tgl.deleteShader(retsh);\n\t\tconsole.error(errlog);\n\t\treturn null;\n\t}\n\treturn retsh;\n}\n\nfunction createShader(vtxsrc, frgsrc, uniformlist, attrlist) {\n    var vsh = compileShader(gl.VERTEX_SHADER, vtxsrc);\n    var fsh = compileShader(gl.FRAGMENT_SHADER, frgsrc);\n    \n    if(vsh == null || fsh == null) {\n        return null;\n    }\n    \n    var prog = gl.createProgram();\n    gl.attachShader(prog, vsh);\n    gl.attachShader(prog, fsh);\n    \n    gl.deleteShader(vsh);\n    gl.deleteShader(fsh);\n    \n    gl.linkProgram(prog);\n    if (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\n        var errlog = gl.getProgramInfoLog(prog);\n        console.error(errlog);\n        return null;\n    }\n    \n    if(uniformlist) {\n        prog.uniforms = {};\n        for(var i = 0; i < uniformlist.length; i++) {\n            prog.uniforms[uniformlist[i]] = gl.getUniformLocation(prog, uniformlist[i]);\n        }\n    }\n    \n    if(attrlist) {\n        prog.attributes = {};\n        for(var i = 0; i < attrlist.length; i++) {\n            var attr = attrlist[i];\n            prog.attributes[attr] = gl.getAttribLocation(prog, attr);\n        }\n    }\n    \n    return prog;\n}\n\nfunction useShader(prog) {\n    gl.useProgram(prog);\n    for(var attr in prog.attributes) {\n        gl.enableVertexAttribArray(prog.attributes[attr]);;\n    }\n}\n\nfunction unuseShader(prog) {\n    for(var attr in prog.attributes) {\n        gl.disableVertexAttribArray(prog.attributes[attr]);;\n    }\n    gl.useProgram(null);\n}\n\n/////\nvar projection = {\n    'angle':60,\n    'nearfar':new Float32Array([0.1, 100.0]),\n    'matrix':Matrix44.createIdentity()\n};\nvar camera = {\n    'position':Vector3.create(0, 0, 100),\n    'lookat':Vector3.create(0, 0, 0),\n    'up':Vector3.create(0, 1, 0),\n    'dof':Vector3.create(10.0, 4.0, 8.0),\n    'matrix':Matrix44.createIdentity()\n};\n\nvar pointFlower = {};\nvar meshFlower = {};\nvar sceneStandBy = false;\n\nvar BlossomParticle = function () {\n    this.velocity = new Array(3);\n    this.rotation = new Array(3);\n    this.position = new Array(3);\n    this.euler = new Array(3);\n    this.size = 1.0;\n    this.alpha = 1.0;\n    this.zkey = 0.0;\n};\n\nBlossomParticle.prototype.setVelocity = function (vx, vy, vz) {\n    this.velocity[0] = vx;\n    this.velocity[1] = vy;\n    this.velocity[2] = vz;\n};\n\nBlossomParticle.prototype.setRotation = function (rx, ry, rz) {\n    this.rotation[0] = rx;\n    this.rotation[1] = ry;\n    this.rotation[2] = rz;\n};\n\nBlossomParticle.prototype.setPosition = function (nx, ny, nz) {\n    this.position[0] = nx;\n    this.position[1] = ny;\n    this.position[2] = nz;\n};\n\nBlossomParticle.prototype.setEulerAngles = function (rx, ry, rz) {\n    this.euler[0] = rx;\n    this.euler[1] = ry;\n    this.euler[2] = rz;\n};\n\nBlossomParticle.prototype.setSize = function (s) {\n    this.size = s;\n};\n\nBlossomParticle.prototype.update = function (dt, et) {\n    this.position[0] += this.velocity[0] * dt;\n    this.position[1] += this.velocity[1] * dt;\n    this.position[2] += this.velocity[2] * dt;\n    \n    this.euler[0] += this.rotation[0] * dt;\n    this.euler[1] += this.rotation[1] * dt;\n    this.euler[2] += this.rotation[2] * dt;\n};\n\nfunction createPointFlowers() {\n    // get point sizes\n    var prm = gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);\n    renderSpec.pointSize = {'min':prm[0], 'max':prm[1]};\n    \n    var vtxsrc = document.getElementById(\"sakura_point_vsh\").textContent;\n    var frgsrc = document.getElementById(\"sakura_point_fsh\").textContent;\n    \n    pointFlower.program = createShader(\n        vtxsrc, frgsrc,\n        ['uProjection', 'uModelview', 'uResolution', 'uOffset', 'uDOF', 'uFade'],\n        ['aPosition', 'aEuler', 'aMisc']\n    );\n    \n    useShader(pointFlower.program);\n    pointFlower.offset = new Float32Array([0.0, 0.0, 0.0]);\n    pointFlower.fader = Vector3.create(0.0, 10.0, 0.0);\n    \n    // paramerters: velocity[3], rotate[3]\n    pointFlower.numFlowers = 1600;\n    pointFlower.particles = new Array(pointFlower.numFlowers);\n    // vertex attributes {position[3], euler_xyz[3], size[1]}\n    pointFlower.dataArray = new Float32Array(pointFlower.numFlowers * (3 + 3 + 2));\n    pointFlower.positionArrayOffset = 0;\n    pointFlower.eulerArrayOffset = pointFlower.numFlowers * 3;\n    pointFlower.miscArrayOffset = pointFlower.numFlowers * 6;\n    \n    pointFlower.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    \n    unuseShader(pointFlower.program);\n    \n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        pointFlower.particles[i] = new BlossomParticle();\n    }\n}\n\nfunction initPointFlowers() {\n    //area\n    pointFlower.area = Vector3.create(20.0, 20.0, 20.0);\n    pointFlower.area.x = pointFlower.area.y * renderSpec.aspect;\n    \n    pointFlower.fader.x = 10.0; //env fade start\n    pointFlower.fader.y = pointFlower.area.z; //env fade half\n    pointFlower.fader.z = 0.1;  //near fade start\n    \n    //particles\n    var PI2 = Math.PI * 2.0;\n    var tmpv3 = Vector3.create(0, 0, 0);\n    var tmpv = 0;\n    var symmetryrand = function() {return (Math.random() * 2.0 - 1.0);};\n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var tmpprtcl = pointFlower.particles[i];\n        \n        //velocity\n        tmpv3.x = symmetryrand() * 0.3 + 0.8;\n        tmpv3.y = symmetryrand() * 0.2 - 1.0;\n        tmpv3.z = symmetryrand() * 0.3 + 0.5;\n        Vector3.normalize(tmpv3);\n        tmpv = 2.0 + Math.random() * 1.0;\n        tmpprtcl.setVelocity(tmpv3.x * tmpv, tmpv3.y * tmpv, tmpv3.z * tmpv);\n        \n        //rotation\n        tmpprtcl.setRotation(\n            symmetryrand() * PI2 * 0.5,\n            symmetryrand() * PI2 * 0.5,\n            symmetryrand() * PI2 * 0.5\n        );\n        \n        //position\n        tmpprtcl.setPosition(\n            symmetryrand() * pointFlower.area.x,\n            symmetryrand() * pointFlower.area.y,\n            symmetryrand() * pointFlower.area.z\n        );\n        \n        //euler\n        tmpprtcl.setEulerAngles(\n            Math.random() * Math.PI * 2.0,\n            Math.random() * Math.PI * 2.0,\n            Math.random() * Math.PI * 2.0\n        );\n        \n        //size\n        tmpprtcl.setSize(0.9 + Math.random() * 0.1);\n    }\n}\n\nfunction renderPointFlowers() {\n    //update\n    var PI2 = Math.PI * 2.0;\n    var limit = [pointFlower.area.x, pointFlower.area.y, pointFlower.area.z];\n    var repeatPos = function (prt, cmp, limit) {\n        if(Math.abs(prt.position[cmp]) - prt.size * 0.5 > limit) {\n            //out of area\n            if(prt.position[cmp] > 0) {\n                prt.position[cmp] -= limit * 2.0;\n            }\n            else {\n                prt.position[cmp] += limit * 2.0;\n            }\n        }\n    };\n    var repeatEuler = function (prt, cmp) {\n        prt.euler[cmp] = prt.euler[cmp] % PI2;\n        if(prt.euler[cmp] < 0.0) {\n            prt.euler[cmp] += PI2;\n        }\n    };\n    \n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var prtcl = pointFlower.particles[i];\n        prtcl.update(timeInfo.delta, timeInfo.elapsed);\n        repeatPos(prtcl, 0, pointFlower.area.x);\n        repeatPos(prtcl, 1, pointFlower.area.y);\n        repeatPos(prtcl, 2, pointFlower.area.z);\n        repeatEuler(prtcl, 0);\n        repeatEuler(prtcl, 1);\n        repeatEuler(prtcl, 2);\n        \n        prtcl.alpha = 1.0;//(pointFlower.area.z - prtcl.position[2]) * 0.5;\n        \n        prtcl.zkey = (camera.matrix[2] * prtcl.position[0]\n                    + camera.matrix[6] * prtcl.position[1]\n                    + camera.matrix[10] * prtcl.position[2]\n                    + camera.matrix[14]);\n    }\n    \n    // sort\n    pointFlower.particles.sort(function(p0, p1){return p0.zkey - p1.zkey;});\n    \n    // update data\n    var ipos = pointFlower.positionArrayOffset;\n    var ieuler = pointFlower.eulerArrayOffset;\n    var imisc = pointFlower.miscArrayOffset;\n    for(var i = 0; i < pointFlower.numFlowers; i++) {\n        var prtcl = pointFlower.particles[i];\n        pointFlower.dataArray[ipos] = prtcl.position[0];\n        pointFlower.dataArray[ipos + 1] = prtcl.position[1];\n        pointFlower.dataArray[ipos + 2] = prtcl.position[2];\n        ipos += 3;\n        pointFlower.dataArray[ieuler] = prtcl.euler[0];\n        pointFlower.dataArray[ieuler + 1] = prtcl.euler[1];\n        pointFlower.dataArray[ieuler + 2] = prtcl.euler[2];\n        ieuler += 3;\n        pointFlower.dataArray[imisc] = prtcl.size;\n        pointFlower.dataArray[imisc + 1] = prtcl.alpha;\n        imisc += 2;\n    }\n    \n    //draw\n    gl.enable(gl.BLEND);\n    //gl.disable(gl.DEPTH_TEST);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    \n    var prog = pointFlower.program;\n    useShader(prog);\n    \n    gl.uniformMatrix4fv(prog.uniforms.uProjection, false, projection.matrix);\n    gl.uniformMatrix4fv(prog.uniforms.uModelview, false, camera.matrix);\n    gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\n    gl.uniform3fv(prog.uniforms.uDOF, Vector3.arrayForm(camera.dof));\n    gl.uniform3fv(prog.uniforms.uFade, Vector3.arrayForm(pointFlower.fader));\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, pointFlower.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, pointFlower.dataArray, gl.DYNAMIC_DRAW);\n    \n    gl.vertexAttribPointer(prog.attributes.aPosition, 3, gl.FLOAT, false, 0, pointFlower.positionArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    gl.vertexAttribPointer(prog.attributes.aEuler, 3, gl.FLOAT, false, 0, pointFlower.eulerArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    gl.vertexAttribPointer(prog.attributes.aMisc, 2, gl.FLOAT, false, 0, pointFlower.miscArrayOffset * Float32Array.BYTES_PER_ELEMENT);\n    \n    // doubler\n    for(var i = 1; i < 2; i++) {\n        var zpos = i * -2.0;\n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x * -1.0;\n        pointFlower.offset[1] = pointFlower.area.y *  1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x *  1.0;\n        pointFlower.offset[1] = pointFlower.area.y * -1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n        \n        pointFlower.offset[0] = pointFlower.area.x *  1.0;\n        pointFlower.offset[1] = pointFlower.area.y *  1.0;\n        pointFlower.offset[2] = pointFlower.area.z * zpos;\n        gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n        gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n    }\n    \n    //main\n    pointFlower.offset[0] = 0.0;\n    pointFlower.offset[1] = 0.0;\n    pointFlower.offset[2] = 0.0;\n    gl.uniform3fv(prog.uniforms.uOffset, pointFlower.offset);\n    gl.drawArrays(gl.POINT, 0, pointFlower.numFlowers);\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    unuseShader(prog);\n    \n    gl.enable(gl.DEPTH_TEST);\n    gl.disable(gl.BLEND);\n}\n\n// effects\n//common util\nfunction createEffectProgram(vtxsrc, frgsrc, exunifs, exattrs) {\n    var ret = {};\n    var unifs = ['uResolution', 'uSrc', 'uDelta'];\n    if(exunifs) {\n        unifs = unifs.concat(exunifs);\n    }\n    var attrs = ['aPosition'];\n    if(exattrs) {\n        attrs = attrs.concat(exattrs);\n    }\n    \n    ret.program = createShader(vtxsrc, frgsrc, unifs, attrs);\n    useShader(ret.program);\n    \n    ret.dataArray = new Float32Array([\n        -1.0, -1.0,\n         1.0, -1.0,\n        -1.0,  1.0,\n         1.0,  1.0\n    ]);\n    ret.buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, ret.buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, ret.dataArray, gl.STATIC_DRAW);\n    \n    gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    unuseShader(ret.program);\n    \n    return ret;\n}\n\n// basic usage\n// useEffect(prog, srctex({'texture':texid, 'dtxArray':(f32)[dtx, dty]})); //basic initialize\n// gl.uniform**(...); //additional uniforms\n// drawEffect()\n// unuseEffect(prog)\n// TEXTURE0 makes src\nfunction useEffect(fxobj, srctex) {\n    var prog = fxobj.program;\n    useShader(prog);\n    gl.uniform3fv(prog.uniforms.uResolution, renderSpec.array);\n    \n    if(srctex != null) {\n        gl.uniform2fv(prog.uniforms.uDelta, srctex.dtxArray);\n        gl.uniform1i(prog.uniforms.uSrc, 0);\n        \n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, srctex.texture);\n    }\n}\nfunction drawEffect(fxobj) {\n    gl.bindBuffer(gl.ARRAY_BUFFER, fxobj.buffer);\n    gl.vertexAttribPointer(fxobj.program.attributes.aPosition, 2, gl.FLOAT, false, 0, 0);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n}\nfunction unuseEffect(fxobj) {\n    unuseShader(fxobj.program);\n}\n\nvar effectLib = {};\nfunction createEffectLib() {\n    \n    var vtxsrc, frgsrc;\n    //common\n    var cmnvtxsrc = document.getElementById(\"fx_common_vsh\").textContent;\n    \n    //background\n    frgsrc = document.getElementById(\"bg_fsh\").textContent;\n    effectLib.sceneBg = createEffectProgram(cmnvtxsrc, frgsrc, ['uTimes'], null);\n    \n    // make brightpixels buffer\n    frgsrc = document.getElementById(\"fx_brightbuf_fsh\").textContent;\n    effectLib.mkBrightBuf = createEffectProgram(cmnvtxsrc, frgsrc, null, null);\n    \n    // direction blur\n    frgsrc = document.getElementById(\"fx_dirblur_r4_fsh\").textContent;\n    effectLib.dirBlur = createEffectProgram(cmnvtxsrc, frgsrc, ['uBlurDir'], null);\n    \n    //final composite\n    vtxsrc = document.getElementById(\"pp_final_vsh\").textContent;\n    frgsrc = document.getElementById(\"pp_final_fsh\").textContent;\n    effectLib.finalComp = createEffectProgram(vtxsrc, frgsrc, ['uBloom'], null);\n}\n\n// background\nfunction createBackground() {\n    //console.log(\"create background\");\n}\nfunction initBackground() {\n    //console.log(\"init background\");\n}\nfunction renderBackground() {\n    gl.disable(gl.DEPTH_TEST);\n    \n    useEffect(effectLib.sceneBg, null);\n    gl.uniform2f(effectLib.sceneBg.program.uniforms.uTimes, timeInfo.elapsed, timeInfo.delta);\n    drawEffect(effectLib.sceneBg);\n    unuseEffect(effectLib.sceneBg);\n    \n    gl.enable(gl.DEPTH_TEST);\n}\n\n// post process\nvar postProcess = {};\nfunction createPostProcess() {\n    //console.log(\"create post process\");\n}\nfunction initPostProcess() {\n    //console.log(\"init post process\");\n}\n\nfunction renderPostProcess() {\n    gl.enable(gl.TEXTURE_2D);\n    gl.disable(gl.DEPTH_TEST);\n    var bindRT = function (rt, isclear) {\n        gl.bindFramebuffer(gl.FRAMEBUFFER, rt.frameBuffer);\n        gl.viewport(0, 0, rt.width, rt.height);\n        if(isclear) {\n            gl.clearColor(0, 0, 0, 0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n    };\n    \n    //make bright buff\n    bindRT(renderSpec.wHalfRT0, true);\n    useEffect(effectLib.mkBrightBuf, renderSpec.mainRT);\n    drawEffect(effectLib.mkBrightBuf);\n    unuseEffect(effectLib.mkBrightBuf);\n    \n    // make bloom\n    for(var i = 0; i < 2; i++) {\n        var p = 1.5 + 1 * i;\n        var s = 2.0 + 1 * i;\n        bindRT(renderSpec.wHalfRT1, true);\n        useEffect(effectLib.dirBlur, renderSpec.wHalfRT0);\n        gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, p, 0.0, s, 0.0);\n        drawEffect(effectLib.dirBlur);\n        unuseEffect(effectLib.dirBlur);\n        \n        bindRT(renderSpec.wHalfRT0, true);\n        useEffect(effectLib.dirBlur, renderSpec.wHalfRT1);\n        gl.uniform4f(effectLib.dirBlur.program.uniforms.uBlurDir, 0.0, p, 0.0, s);\n        drawEffect(effectLib.dirBlur);\n        unuseEffect(effectLib.dirBlur);\n    }\n    \n    //display\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, renderSpec.width, renderSpec.height);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    \n    useEffect(effectLib.finalComp, renderSpec.mainRT);\n    gl.uniform1i(effectLib.finalComp.program.uniforms.uBloom, 1);\n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, renderSpec.wHalfRT0.texture);\n    drawEffect(effectLib.finalComp);\n    unuseEffect(effectLib.finalComp);\n    \n    gl.enable(gl.DEPTH_TEST);\n}\n\n/////\nvar SceneEnv = {};\nfunction createScene() {\n    createEffectLib();\n    createBackground();\n    createPointFlowers();\n    createPostProcess();\n    sceneStandBy = true;\n}\n\nfunction initScene() {\n    initBackground();\n    initPointFlowers();\n    initPostProcess();\n    \n    //camera.position.z = 17.320508;\n    camera.position.z = pointFlower.area.z + projection.nearfar[0];\n    projection.angle = Math.atan2(pointFlower.area.y, camera.position.z + pointFlower.area.z) * 180.0 / Math.PI * 2.0;\n    Matrix44.loadProjection(projection.matrix, renderSpec.aspect, projection.angle, projection.nearfar[0], projection.nearfar[1]);\n}\n\nfunction renderScene() {\n    //draw\n    Matrix44.loadLookAt(camera.matrix, camera.position, camera.lookat, camera.up);\n    \n    gl.enable(gl.DEPTH_TEST);\n    \n    //gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, renderSpec.mainRT.frameBuffer);\n    gl.viewport(0, 0, renderSpec.mainRT.width, renderSpec.mainRT.height);\n    gl.clearColor(0.005, 0, 0.05, 0);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    \n    renderBackground();\n    renderPointFlowers();\n    renderPostProcess();\n}\n\n/////\nfunction onResize(e) {\n    makeCanvasFullScreen(document.getElementById(\"sakura\"));\n    setViewports();\n    if(sceneStandBy) {\n        initScene();\n    }\n}\n\nfunction setViewports() {\n    renderSpec.setSize(gl.canvas.width, gl.canvas.height);\n    \n    gl.clearColor(0.2, 0.2, 0.5, 1.0);\n    gl.viewport(0, 0, renderSpec.width, renderSpec.height);\n    \n    var rtfunc = function (rtname, rtw, rth) {\n        var rt = renderSpec[rtname];\n        if(rt) deleteRenderTarget(rt);\n        renderSpec[rtname] = createRenderTarget(rtw, rth);\n    };\n    rtfunc('mainRT', renderSpec.width, renderSpec.height);\n    rtfunc('wFullRT0', renderSpec.width, renderSpec.height);\n    rtfunc('wFullRT1', renderSpec.width, renderSpec.height);\n    rtfunc('wHalfRT0', renderSpec.halfWidth, renderSpec.halfHeight);\n    rtfunc('wHalfRT1', renderSpec.halfWidth, renderSpec.halfHeight);\n}\n\nfunction render() {\n    renderScene();\n}\n\nvar animating = true;\nfunction toggleAnimation(elm) {\n    animating ^= true;\n    if(animating) animate();\n    if(elm) {\n        elm.innerHTML = animating? \"Stop\":\"Start\";\n    }\n}\n\nfunction stepAnimation() {\n    if(!animating) animate();\n}\n\nfunction animate() {\n    var curdate = new Date();\n    timeInfo.elapsed = (curdate - timeInfo.start) / 1000.0;\n    timeInfo.delta = (curdate - timeInfo.prev) / 1000.0;\n    timeInfo.prev = curdate;\n    \n    if(animating) requestAnimationFrame(animate);\n    render();\n}\n\nfunction makeCanvasFullScreen(canvas) {\n    var b = document.body;\n\tvar d = document.documentElement;\n\tfullw = Math.max(b.clientWidth , b.scrollWidth, d.scrollWidth, d.clientWidth);\n\tfullh = Math.max(b.clientHeight , b.scrollHeight, d.scrollHeight, d.clientHeight);\n\tcanvas.width = fullw;\n\tcanvas.height = fullh;\n}\n\nwindow.addEventListener('load', function(e) {\n    var canvas = document.getElementById(\"sakura\");\n    try {\n        makeCanvasFullScreen(canvas);\n        gl = canvas.getContext('experimental-webgl');\n    } catch(e) {\n        alert(\"WebGL not supported.\" + e);\n        console.error(e);\n        return;\n    }\n    \n    window.addEventListener('resize', onResize);\n    \n    setViewports();\n    createScene();\n    initScene();\n    \n    timeInfo.start = new Date();\n    timeInfo.prev = timeInfo.start;\n    animate();\n});\n\n//set window.requestAnimationFrame\n(function (w, r) {\n    w['r'+r] = w['r'+r] || w['webkitR'+r] || w['mozR'+r] || w['msR'+r] || w['oR'+r] || function(c){ w.setTimeout(c, 1000 / 60); };\n})(window, 'equestAnimationFrame');"]}